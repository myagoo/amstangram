/*! For license information please see component---src-pages-index-js-96c482de09937244a3be.js.LICENSE.txt */
(self.webpackChunk=self.webpackChunk||[]).push([[678],{7757:function(e,t,r){e.exports=r(5666)},3322:function(e,t,r){"use strict";var n,a=(n=r(4892))&&"object"==typeof n&&"default"in n?n.default:n;a.registerVersion("firebase","7.14.0","app"),e.exports=a},1046:function(e,t,r){"use strict";r.d(t,{w_:function(){return u}});var n=r(7294),a={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},o=n.createContext&&n.createContext(a),i=function(){return i=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var a in t=arguments[r])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e},i.apply(this,arguments)},s=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(n=Object.getOwnPropertySymbols(e);a<n.length;a++)t.indexOf(n[a])<0&&Object.prototype.propertyIsEnumerable.call(e,n[a])&&(r[n[a]]=e[n[a]])}return r};function c(e){return e&&e.map((function(e,t){return n.createElement(e.tag,i({key:t},e.attr),c(e.child))}))}function u(e){return function(t){return n.createElement(l,i({attr:i({},e.attr)},t),c(e.child))}}function l(e){var t=function(t){var r,a=e.attr,o=e.size,c=e.title,u=s(e,["attr","size","title"]),l=o||t.size||"1em";return t.className&&(r=t.className),e.className&&(r=(r?r+" ":"")+e.className),n.createElement("svg",i({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},t.attr,a,u,{className:r,style:i(i({color:e.color||t.color},t.style),e.style),height:l,width:l,xmlns:"http://www.w3.org/2000/svg"}),c&&n.createElement("title",null,c),e.children)};return void 0!==o?n.createElement(o.Consumer,null,(function(e){return t(e)})):t(a)}},9580:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return vn}});var n=r(6147),a=r(7294),o=r(5333),i=r(5861);function s(){var e=a.useContext(o._y);return(0,i.lq)(e),e}function c(e,t){if(null==e)return{};var r,n,a={},o=Object.keys(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||(a[r]=e[r]);return a}var u=["css"],l=(0,n.createPrimitive)("div",(function(e){var t=e.css,r=c(e,u);return Object.assign({css:(0,n.useGap)(Object.assign({display:"flex",minWidth:0,minHeight:0,flex:"none",alignSelf:"auto",alignItems:"stretch",flexDirection:"column",justifyContent:"flex-start"},t))},r)})),d=function(e){var t=(0,a.useContext)(n.ThemeContext);return a.createElement(l,Object.assign({as:"svg",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 467.27 512"},e),a.createElement("polygon",{fill:t.colors.shape,points:"352.33 159.67 432.16 239.45 432.16 399.13 319.29 512 93.55 512 159.67 445.87 0 286.25 319.29 286.25 272.55 239.45 272.55 79.84 352.33 0 465.26 112.87 352.33 112.87 352.33 159.67"}),a.createElement("g",null,a.createElement("polygon",{fill:t.colors.pieces.mt1,points:"272.57 79.84 272.57 239.45 352.36 319.29 432.19 399.13 432.19 239.45 352.36 159.67 352.36 112.87 465.29 112.87 352.36 0 272.57 79.84"}),a.createElement("polygon",{fill:t.colors.pieces.st1,points:"93.58 512 319.32 512 432.19 399.13 319.32 286.25 93.58 512"}),a.createElement("polygon",{fill:t.colors.pieces.lt2,points:"159.67 445.87 239.48 366.05 319.31 286.24 0.03 286.24 159.67 445.87"})))},f=r(7817);function m(e,t,r,n,a,o,i){try{var s=e[o](i),c=s.value}catch(u){return void r(u)}s.done?t(c):Promise.resolve(c).then(n,a)}function p(e){return function(){var t=this,r=arguments;return new Promise((function(n,a){var o=e.apply(t,r);function i(e){m(o,n,a,i,s,"next",e)}function s(e){m(o,n,a,i,s,"throw",e)}i(void 0)}))}}var g=r(2982),v=r(7757),h=r.n(v),b=r(3322),y=r.n(b);y().apps.length||y().initializeApp({apiKey:"AIzaSyAHOemftrTSOUjtoA6K3VR2hkOU5H-ScSI",authDomain:"amstangram.firebaseapp.com",databaseURL:"https://amstangram.firebaseio.com",projectId:"amstangram",storageBucket:"amstangram.appspot.com",messagingSenderId:"1075176148116",appId:"1:1075176148116:web:e61e6512cd983a75533881",measurementId:"G-PLH3BSWLM2"});var E=y(),w=r(3935),x=(0,n.extendPrimitive)(l,{css:{fontSize:3,p:2,borderRadius:1,bg:"notificationBackground",color:"dialogText",animation:f.FADE_TRANSITION_DURATION/2+"ms fadeIn both",boxShadow:"0px 0px 10px #00000080"}}),S=(0,a.createContext)(null),C=function(e){var t=e.children,r=(0,a.useRef)(),n=(0,a.useState)(null),o=n[0],i=n[1],s=(0,a.useCallback)((function(e){i((function(t){return t&&clearTimeout(t.timeoutId),{content:e,timeoutId:setTimeout((function(){i(null)}),2e3)}}))}),[]);return a.createElement(S.Provider,{value:s},t,o&&(0,w.createPortal)(a.createElement(l,{css:{position:"fixed",top:0,left:0,bottom:0,right:0,pointerEvents:"none",alignItems:"center",justifyContent:"center"}},a.createElement(x,{ref:r},o.content)),document.getElementById("notificationContainer")))};function k(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(r)return(r=r.call(e)).next.bind(r);if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return A(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return A(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0;return function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function A(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var O=(0,a.createContext)(null),I=function(e){var t=e.children,r=(0,a.useState)(void 0),n=r[0],o=r[1],i=(0,a.useState)(null),s=i[0],c=i[1],u=(0,a.useState)(!1),l=u[0],d=u[1];(0,a.useEffect)((function(){void 0!==n&&null!==s&&d(!0)}),[n,s]),(0,a.useEffect)((function(){var e=E.auth().onAuthStateChanged(function(){var e=p(h().mark((function e(t){var r,n;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=4;break}o(null),e.next=9;break;case 4:return e.next=6,E.firestore().collection("users").doc(t.uid).get();case 6:r=e.sent,n=r.data(),o(Object.assign({uid:t.uid},n,{firebaseUser:t}));case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());return e}),[]),(0,a.useEffect)((function(){return E.firestore().collection("users").onSnapshot((function(e){for(var t,r={},n=k(e.docs);!(t=n()).done;){var a=t.value,o=a.data();r[a.id]=o}c(r)}))}),[]);var f=(0,a.useCallback)(function(){var e=p(h().mark((function e(t,r){return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.firebaseUser.updateProfile({displayName:r});case 2:return e.next=4,E.firestore().collection("users").doc(t.uid).update({username:r});case 4:o(Object.assign({},t,{username:r}));case 5:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),[]),m=(0,a.useCallback)(function(){var e=p(h().mark((function e(t,r,n){var a;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=E.auth.EmailAuthProvider.credential(t.firebaseUser.email,r),e.next=3,t.firebaseUser.reauthenticateWithCredential(a);case 3:return e.next=5,t.firebaseUser.updatePassword(n);case 5:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}(),[]),g=(0,a.useCallback)(function(){var e=p(h().mark((function e(t,r,n){var a;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=E.auth.EmailAuthProvider.credential(t.firebaseUser.email,n),e.next=3,t.firebaseUser.reauthenticateWithCredential(a);case 3:return e.next=5,t.firebaseUser.updateEmail(r);case 5:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}(),[]),v=(0,a.useMemo)((function(){return{initialized:l,currentUser:n,usersMetadata:s,updateUsername:f,updatePassword:m,updateEmail:g}}),[l,n,s,f,m,g]);return a.createElement(O.Provider,{value:v},t)};function M(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(r)return(r=r.call(e)).next.bind(r);if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return T(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return T(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0;return function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function T(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var j=(0,a.createContext)([]),_=function(e){var t=e.children,r=(0,a.useContext)(O).currentUser,n=(0,a.useState)(null),o=n[0],i=n[1];(0,a.useEffect)((function(){return E.firestore().collection("tangrams").onSnapshot((function(e){for(var t,r=[],n=M(e.docs);!(t=n()).done;){var a=t.value,o=a.id,s=a.data(),c=Object.assign({},s);r.push(Object.assign({id:o},c))}i(r)}))}),[]);var s=(0,a.useMemo)((function(){if(!o)return{initialized:!1,approvedTangrams:null,pendingTangrams:null,approvedTangramsByCategory:null};for(var e,t=[],n=[],a=M(o);!(e=a()).done;){var i=e.value;i.approved?t.push(i):r&&(r.isAdmin||i.uid===r.uid)&&n.push(i)}return{initialized:!0,approvedTangrams:t,pendingTangrams:n}}),[r,o]);return a.createElement(j.Provider,{value:s},t)};function R(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(r)return(r=r.call(e)).next.bind(r);if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return D(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return D(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0;return function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function D(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var L=(0,a.createContext)(null),P=function(e){var t=e.children,r=s(),n=(0,a.useContext)(S),o=(0,a.useContext)(O).currentUser,i=(0,a.useContext)(j).approvedTangrams,c=(0,a.useState)(null),u=c[0],l=c[1],d=(0,a.useState)(null),f=d[0],m=d[1],v=(0,a.useState)(null),b=v[0],y=v[1],w=(0,a.useState)(0),x=w[0],C=w[1],k=(0,a.useState)(!1),A=k[0],I=k[1];(0,a.useEffect)((function(){u&&f&&I(!0)}),[u,f]),(0,a.useEffect)((function(){return E.firestore().collection("stats").onSnapshot((function(e){for(var t,r={},n={},a=R(e.docs);!(t=a()).done;){var o=t.value,i=o.id,s=o.data();for(var c in r[i]||(r[i]={},n[i]={}),s)r[i][c]=s[c].completed,n[i][c]=s[c].starred}l(r),m(n)}))}),[]);var M=(0,a.useCallback)((function(e){return!(!o||!f[e])&&!0===f[e][o.uid]}),[o,f]),T=(0,a.useCallback)((function(e){return!(!o||!u[e])&&void 0!==u[e][o.uid]}),[o,u]),_=(0,a.useCallback)((function(e){var t,a,i=window.location.origin+"/?tangrams="+e.map((function(e){return e.id})).join(",");o&&(i+="&uid="+o.uid),t=i,(a=document.createElement("textarea")).value=t,document.body.appendChild(a),a.select(),document.execCommand("copy"),document.body.removeChild(a),n(r.formatMessage({id:"Challenge link copied to clipboard"}))}),[n,o,r]),D=(0,a.useCallback)((function(){C((function(e){return e+1}))}),[]),P=(0,a.useCallback)((function(e){var t=e?function(e,t){var r=e.id,n=e.edges,a=t.id,o=t.edges,i=T(r),s=T(a);return i||s?i-s:o-n}:function(e,t){var r=e.id,n=t.id;return T(r)-T(n)},r=function(e){for(var t,r,n=e.length;0!==n;)r=Math.floor(Math.random()*n),t=e[n-=1],e[n]=e[r],e[r]=t;return e}((0,g.Z)(i)).sort(t);y(r)}),[i,T]),N=(0,a.useCallback)(function(){var e=p(h().mark((function e(t,r){var n;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!o||!i.some((function(e){return e.id===t.id}))||T(t.id)){e.next=3;break}return e.next=3,E.firestore().collection("stats").doc(t.id).set(((n={})[o.uid]={completed:r},n),{merge:!0});case 3:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),[i,o,T]),U=(0,a.useCallback)(function(){var e=p(h().mark((function e(t){var r,n;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!o||!i.some((function(e){return e.id===t.id}))){e.next=4;break}return n=M(t.id),e.next=4,E.firestore().collection("stats").doc(t.id).set(((r={})[o.uid]={starred:!n},r),{merge:!0});case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[i,o,M]),F=(0,a.useMemo)((function(){return{initialized:A,requestSave:D,saveRequestId:x,playlist:b,setPlaylist:y,shareTangrams:_,startRandomPlaylist:P,tangramsCompletedBy:u,tangramsStarredBy:f,toggleTangramStar:U,markTangramAsComplete:N,isTangramCompleted:T,isTangramStarred:M}}),[A,D,x,b,_,P,u,f,U,N,T,M]);return a.createElement(L.Provider,{value:F},t)},N=r(3750);function U(){return U=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},U.apply(this,arguments)}var F=function(e,t){void 0===t&&(t={});var n,o=t,i=o.volume,s=void 0===i?1:i,c=o.playbackRate,u=void 0===c?1:c,l=o.soundEnabled,d=void 0===l||l,f=o.interrupt,m=void 0!==f&&f,p=o.onload,g=function(e,t){if(null==e)return{};var r,n,a={},o=Object.keys(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||(a[r]=e[r]);return a}(o,["id","volume","playbackRate","soundEnabled","interrupt","onload"]),v=a.useRef(null),h=a.useRef(!1),b=a.useState(null),y=b[0],E=b[1],w=a.useState(null),x=w[0],S=w[1],C=function(){"function"==typeof p&&p.call(this),h.current&&E(1e3*this.duration()),S(this)};n=function(){return r.e(365).then(r.t.bind(r,6365,23)).then((function(t){var r;h.current||(v.current=null!==(r=t.Howl)&&void 0!==r?r:t.default.Howl,h.current=!0,new v.current(U({src:Array.isArray(e)?e:[e],volume:s,rate:u,onload:C},g)))})),function(){h.current=!1}},(0,a.useEffect)(n,[]),a.useEffect((function(){v.current&&x&&S(new v.current(U({src:Array.isArray(e)?e:[e],volume:s,onload:C},g)))}),[JSON.stringify(e)]),a.useEffect((function(){x&&(x.volume(s),x.rate(u))}),[s,u]);var k=a.useCallback((function(e){void 0===e&&(e={}),x&&(d||e.forceSoundEnabled)&&(m&&x.stop(),e.playbackRate&&x.rate(e.playbackRate),x.play(e.id))}),[x,d,m]),A=a.useCallback((function(e){x&&x.stop(e)}),[x]),O=a.useCallback((function(e){x&&x.pause(e)}),[x]);return[k,{sound:x,stop:A,pause:O,duration:y}]},V=r.p+"static/star-a46cf5189a2688d87d665c2befbef64c.wav",z=r.p+"static/button-8b24bcedcccb791b25194297eeb24943.wav",B=r.p+"static/card-b05a7b6659023812d652b2e1ec172c0c.wav",G=r.p+"static/pop-15167204762122a48c3ea7b03541b75a.wav",q=r.p+"static/victory-f1f96272b3b6267e3c5f86b47e4d8cf9.wav",W=(0,a.createContext)([!0,function(){}]),Y=function(e){var t=e.children,r=(0,a.useState)(!0),n=r[0],o=r[1],i=F(V,{soundEnabled:n})[0],s=F(z,{soundEnabled:n})[0],c=F(z,{soundEnabled:n})[0],u=F(B,{soundEnabled:n})[0],l=F(G,{soundEnabled:n})[0],d=F(q,{soundEnabled:n})[0];(0,a.useEffect)((function(){o("off"!==window.localStorage.getItem("sound"))}),[]);var f=(0,a.useCallback)((function(){var e=!n;o(e),window.localStorage.setItem("sound",e?"on":"off")}),[n]),m=(0,a.useMemo)((function(){return{soundEnabled:n,toggleSound:f,playButton:s,playToggle:c,playCard:u,playStar:i,playTangram:l,playVictory:d}}),[n,f,s,c,u,i,l,d]);return a.createElement(W.Provider,{value:m},t)},H=["css","onClick","mute"],$=["css"],Z=(0,n.createPrimitive)("button",(function(e){var t=e.css,r=e.onClick,n=e.mute,o=c(e,H),i=(0,a.useContext)(W).playButton;return Object.assign({css:Object.assign({borderRadius:2,minWidth:0,minHeight:0,flex:"none",fontWeight:"bold",border:"none",fontSize:"inherit",color:"inherit",background:"none",cursor:"pointer",p:3,"&:disabled":{opacity:.3,cursor:"not-allowed"},"&:focus":{outline:"none"}},t),onClick:function(e){n||i(),r&&r(e)}},o)})),J=(0,n.extendPrimitive)(Z,{css:{border:"2px solid",borderRadius:2}}),X=(0,n.extendPrimitive)(Z,{css:{border:"2px solid",color:"errorText"}}),K=(0,n.extendPrimitive)(Z,(function(e){var t=e.css,r=c(e,$),a=(0,n.useKeyframes)({0:{bg:"pieces.lt2"},14:{bg:"pieces.rh"},28:{bg:"pieces.st2"},42:{bg:"pieces.mt1"},57:{bg:"pieces.st1"},71:{bg:"pieces.lt1"},85:{bg:"pieces.sq"},100:{bg:"pieces.lt2"}});return Object.assign({css:Object.assign({animation:a+" 20s linear infinite both",color:"#FFFFFFDD"},t)},r)})),Q=["uid","size","css","onClick"],ee=function(e){var t=e.uid,r=e.size,o=void 0===r?"badge":r,i=e.css,s=e.onClick,u=c(e,Q),d=(0,a.useContext)(W).playButton,f=(0,a.useContext)(n.ThemeContext),m=(0,a.useMemo)((function(){var e=Object.values(f.colors.pieces);return console.log(t),e[t.charCodeAt(0)%e.length].slice(1)}),[f,t]);return a.createElement(l,Object.assign({as:"img",src:"https://api.dicebear.com/7.x/croodles-neutral/svg?seed="+t+"&backgroundColor="+encodeURIComponent(m),css:Object.assign({m:"2px",boxShadow:"0 0 0 2px "+f.colors.dialogText,borderRadius:"50%",backgroundColor:m,size:o},i),onClick:s?function(e){d(),s(e)}:void 0},u))},te=["showStroke","tangram","completed","selected","css","onBadgeClick","onClick","onLongPress","hideBadge"],re=function(e){var t,r,o,i,s,u,d,m,p=e.showStroke,g=e.tangram,v=e.completed,h=e.selected,b=e.css,y=e.onBadgeClick,E=e.onClick,w=e.onLongPress,x=e.hideBadge,S=c(e,te),C=g.path,k=g.width,A=g.height,O=g.uid,I=g.approved,M=g.emoji,T=(0,a.useMemo)((function(){return function(e){return e.edges>16?0:e.edges>8?1:2}(g)}),[g]),j=(0,a.useContext)(W).playCard,_=(0,a.useContext)(n.ThemeContext).colors.difficulties[T],R=(0,a.useCallback)((function(){w&&w(g)}),[w,g]),D=(t=R,r=1e3,o=(0,a.useState)(null),i=o[0],s=o[1],{onMouseDown:u=function(e){if(i&&e.touches&&1!==e.touches.length)clearTimeout(i.timeoutId);else{var n=e.touches?e.touches.item(0):e;s({timeoutId:setTimeout(t,r),startEvent:{clientX:n.clientX,clientY:n.clientY}})}},onMouseUp:m=function(){i&&clearTimeout(i.timeoutId)},onMouseMove:d=function(e){if(i){var t=e.touches?e.touches.item(0):e;Math.sqrt(Math.pow(t.clientX-i.startEvent.clientX,2)+Math.pow(t.clientY-i.startEvent.clientY,2))>10&&clearTimeout(i.timeoutId)}},onMouseLeave:m,onTouchStart:u,onTouchEnd:m,onTouchMove:d});return a.createElement(l,Object.assign({css:b,onClick:E?function(){j(),E(g)}:void 0},D,S),a.createElement(l,{css:{opacity:O&&!1===I?.5:1,borderRadius:5,boxShadow:h?"0px 0px 0px 4px "+_:"0px 0px 0px 1px rgba(0, 0, 0, 0.1)",m:1,bg:"background",transition:"background-color "+f.COLOR_TRANSITION_DURATION+"ms",p:3,textAlign:"center",position:"relative",cursor:E||w?"pointer":void 0,width:128,height:178},deps:[_,h,O,I]},a.createElement(l,{as:"svg",css:{flex:"1",justifyContent:"center",fill:_,stroke:p?"lime":void 0,strokeWidth:p?8:void 0},deps:[p,_],viewBox:"0 0 "+k+" "+A,dangerouslySetInnerHTML:{__html:'<path d="'+C+'" />'}}),v&&a.createElement(l,{css:{position:"absolute",top:1,left:1,fontSize:"30px"}},M),O&&!x&&a.createElement(ee,{uid:O,css:{position:"absolute",bottom:1,right:1,cursor:y?"pointer":void 0},onClick:y?function(e){e.stopPropagation(),y(O)}:void 0})))},ne=["children","title","onClose","css"],ae=function(e){var t=e.children,r=e.title,n=e.onClose,o=e.css,i=c(e,ne),s=(0,a.useContext)(W).playButton;return(0,w.createPortal)(a.createElement(l,{onClick:n,css:{position:"fixed",top:0,left:0,right:0,bottom:0,bg:"#00000080",alignItems:"center",justifyContent:"center",animation:f.FADE_TRANSITION_DURATION/2+"ms fadeIn ease both",p:3}},a.createElement(l,{css:{flex:"0 1 auto",bg:"dialogBackground",color:"dialogText",borderRadius:3,transition:"background-color "+f.COLOR_TRANSITION_DURATION+"ms, color "+f.COLOR_TRANSITION_DURATION+"ms",fontSize:3,p:3,gap:3,maxWidth:"95vw",minWidth:"300px"},onClick:function(e){return e.stopPropagation()}},a.createElement(l,{css:{flexDirection:"row",gap:3,alignItems:"center",justifyContent:"space-between",zIndex:1}},r,a.createElement(l,{as:N.q5L,css:{cursor:"pointer",size:"badge",ml:r?void 0:"auto"},onClick:function(){s(),n()}})),a.createElement(l,Object.assign({css:Object.assign({overflow:"auto",flex:"1",maxWidth:"100%"},o)},i),t))),document.getElementById("dialogContainer"))},oe=(0,n.createPrimitive)("div",{css:{display:"inline",minWidth:0,minHeight:0,flex:"none"}}),ie=(0,n.extendPrimitive)(oe,{css:{fontSize:2,color:"errorText"}}),se=(0,n.extendPrimitive)(oe,{css:{fontSize:2,opacity:.75}}),ce=(0,n.extendPrimitive)(oe,{css:{fontSize:4,fontWeight:"bold"}}),ue=(0,n.extendPrimitive)(oe,{css:{fontSize:3,fontWeight:"bold"}}),le=(0,n.createPrimitive)("a",{css:{cursor:"pointer",textDecoration:"underline",color:"inherit","&:visited":{color:"inherit"}}}),de=(0,n.extendPrimitive)(oe,{css:{cursor:"pointer",textDecoration:"underline"}}),fe=function(e){var t=e.icon,r=e.css;return a.createElement(oe,{as:t,css:Object.assign({position:"relative",top:"0.1em",size:"0.9em"},r)})},me=function(e){var t=e.uid,r=e.tangrams,n=e.deferred,o=s(),i=(0,a.useContext)(O).usersMetadata,c=(0,a.useContext)(L).setPlaylist,u=i[t]?i[t].username:null;return a.createElement(ae,{title:a.createElement(ce,null,u?o.formatMessage({id:"{username} challenged you"},{username:u}):o.formatMessage({id:"Rise to the challenge"},{username:u})),onClose:function(){return n.reject(f.DIALOG_CLOSED_REASON)},css:{gap:3,overflow:"initial",maxWidth:"568px"}},a.createElement(l,{css:{flex:"1",overflow:"auto",flexDirection:"row",flexWrap:"wrap",justifyContent:"center",m:-1}},r.map((function(e){return a.createElement(re,{key:e.id,selected:!0,tangram:e,css:{m:1}})}))),a.createElement(K,{onClick:function(){c(r),n.resolve()}},o.formatMessage({id:"Let's go!"})))},pe=r(9900);function ge(e){var t=s(),r=t.formatMessage,n=t.textComponent,o=void 0===n?a.Fragment:n,i=e.id,c=e.description,u=e.defaultMessage,l=e.values,d=e.children,f=e.tagName,m=void 0===f?o:f,p=r({id:i,description:c,defaultMessage:u},l,{ignoreTag:e.ignoreTag});return"function"==typeof d?d(Array.isArray(p)?p:[p]):m?a.createElement(m,null,a.Children.toArray(p)):a.createElement(a.Fragment,null,p)}ge.displayName="FormattedMessage";var ve=a.memo(ge,(function(e,t){var r=e.values,n=(0,pe._T)(e,["values"]),a=t.values,o=(0,pe._T)(t,["values"]);return(0,i.wU)(a,r)&&(0,i.wU)(n,o)}));ve.displayName="MemoizedFormattedMessage";var he=ve,be=function(e,t){return t.edges===e.edges?t.length-e.length:t.edges-e.edges},ye=function(e,t){return f.DIGITS.indexOf(e.emoji)-f.DIGITS.indexOf(t.emoji)},Ee=function(e,t){return f.LETTERS.indexOf(e.emoji)-f.LETTERS.indexOf(t.emoji)},we=(0,n.createPrimitive)("input",{type:"text",css:{color:"inherit",fontSize:"inherit",bg:"inputBackground",border:"none",borderRadius:2,borderColor:"currentColor",p:2,"&:disabled":{opacity:.5,cursor:"not-allowed"},"&:focus":{outline:"none"}}}),xe=["css"];function Se(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(r)return(r=r.call(e)).next.bind(r);if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return Ce(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Ce(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0;return function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function Ce(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var ke=(0,n.extendPrimitive)(l,(function(e){var t=e.css,r=c(e,xe),o=(0,a.useContext)(n.ThemeContext);return Object.assign({css:Object.assign({p:3,alignItems:"center",position:"sticky",top:0,zIndex:1,background:"linear-gradient(0deg, rgba(0,0,0,0) 0%, "+o.colors.dialogBackground+" 50%)"},t)},r)})),Ae=function(e){var t=e.deferred,r=s(),n=(0,a.useContext)(O).currentUser,o=(0,a.useContext)(j),i=o.pendingTangrams,c=o.approvedTangrams,u=(0,a.useContext)(Vr),d=u.showProfile,m=u.showTangram,p=(0,a.useContext)(L),v=p.setPlaylist,h=p.shareTangrams,b=p.startRandomPlaylist,y=p.isTangramCompleted,E=p.isTangramStarred,w=(0,a.useState)([]),x=w[0],S=w[1],C=(0,a.useState)((function(){var e=window.localStorage.getItem("selectedGalleryFilter");return["all","uncompleted","starred","pending"].includes(e)?e:"all"})),k=C[0],A=C[1],I=(0,a.useCallback)((function(e){console.log(e),S((function(t){return t.some((function(t){return t.id===e.id}))?t.filter((function(t){return t.id!==e.id})):[].concat((0,g.Z)(t),[e])}))}),[]),M=(0,a.useMemo)((function(){for(var e,t={},r=Se("pending"===k?i:c);!(e=r()).done;){var n=e.value;"uncompleted"===k&&y(n.id)||("starred"!==k||E(n.id))&&(t[n.category]||(t[n.category]=[]),t[n.category].push(n))}for(var a,o={},s=Se(Object.keys(t).sort());!(a=s()).done;){var u=a.value;o[u]=t[u].sort("letters"===u?Ee:"digits"===u?ye:be)}return o}),[i,c,k,y,E]),T=Object.keys(M);return a.createElement(a.Fragment,null,a.createElement(ae,{title:a.createElement(ce,null,r.formatMessage({id:"Tangram gallery"})),css:{gap:3,width:"568px"},onClose:function(){return t.reject(f.DIALOG_CLOSED_REASON)}},a.createElement(a.Fragment,null,a.createElement(we,{as:"select",value:k,onChange:function(e){A(e.target.value),window.localStorage.setItem("selectedGalleryFilter",e.target.value)}},a.createElement("option",{value:"all"},r.formatMessage({id:"All tangrams"})),a.createElement("option",{value:"uncompleted"},r.formatMessage({id:"Uncompleted tangrams"})),a.createElement("option",{value:"starred"},r.formatMessage({id:"â˜… Starred tangrams"})),a.createElement("option",{value:"pending"},r.formatMessage({id:"Pending approbation tangrams"}))),a.createElement(l,{css:{flex:"1",overflow:"auto",gap:3}},0===T.length?a.createElement(l,{key:"noresult",css:{gap:3,alignItems:"center"}},"uncompleted"===k?a.createElement(a.Fragment,null,a.createElement(oe,{css:{fontSize:"8em"}},"ðŸ¾"),a.createElement(l,{css:{gap:2,alignItems:"center",px:3}},a.createElement(ue,{css:{textAlign:"center"}},a.createElement(he,{id:"You've completed all tangrams"})),a.createElement(se,null,a.createElement(he,{id:"Come back later for more or create your own tangrams"})))):"pending"===k?n&&n.isAdmin?a.createElement(a.Fragment,null,a.createElement(oe,{css:{fontSize:"8em"}},"ðŸ‘®"),a.createElement(l,{css:{gap:2,alignItems:"center",px:3}},a.createElement(ue,{css:{textAlign:"center"}},a.createElement(he,{id:"No tangram left to approve"})),a.createElement(se,null,a.createElement(he,{id:"Good job moderator {username}!",values:{username:n.username}})))):a.createElement(a.Fragment,null,a.createElement(oe,{css:{fontSize:"8em"}},"ðŸ‘"),a.createElement(l,{css:{gap:2,alignItems:"center",px:3}},a.createElement(ue,{css:{textAlign:"center"}},a.createElement(he,{id:"All your tangrams have been approved"})),a.createElement(se,null,a.createElement(he,{id:"Create more tangrams and earn <starIcon></starIcon>",values:{starIcon:function(){return a.createElement(fe,{icon:N.nae,css:{fill:"currentColor"}})}}})))):"starred"===k?a.createElement(a.Fragment,null,a.createElement(oe,{css:{fontSize:"8em"}},"ðŸŒƒ"),a.createElement(l,{css:{gap:2,alignItems:"center",px:3}},a.createElement(ue,{css:{textAlign:"center"}},a.createElement(he,{id:"No starred tangrams yet"})),a.createElement(se,null,a.createElement(he,{id:"Press <starIcon></starIcon> to star a tangram and show your love",values:{starIcon:function(){return a.createElement(fe,{icon:N.nae,css:{fill:"currentColor"}})}}})))):a.createElement(a.Fragment,null,a.createElement(oe,{css:{fontSize:"8em"}},"ðŸ¤·"),a.createElement(l,{css:{gap:2,alignItems:"center",px:3}},a.createElement(ue,{css:{textAlign:"center"}},a.createElement(he,{id:"Nothing to see here"})),a.createElement(se,null,a.createElement(he,{id:"Something might have gone wrong"}))))):a.createElement(l,{key:"results",css:{flex:"1",overflow:"auto",gap:3}},T.map((function(e){return a.createElement(l,{key:e},a.createElement(ke,null,a.createElement(ue,null,r.formatMessage({id:e}))),a.createElement(l,{css:{display:"grid",gridTemplateColumns:"repeat(auto-fill, 136px)",gridColumnGap:2,gridRowGap:2,justifyContent:"center",justifyItems:"center",alignItems:"center"}},M[e].map((function(e){return a.createElement(re,{showStroke:"pending"===k&&n&&n.isAdmin,key:e.id,tangram:e,completed:y(e.id),selected:x.some((function(t){return t.id===e.id})),onClick:I,onBadgeClick:d,onLongPress:m})}))))})))),a.createElement(l,{css:{flexDirection:"row",gap:2}},a.createElement(K,{onClick:function(){x.length?v(x):b(),t.resolve()},css:{flex:"1"}},0===x.length?r.formatMessage({id:"Play now!"}):1===x.length?r.formatMessage({id:"Start 1 tangram!"}):r.formatMessage({id:"Start {count} tangrams!"},{count:x.length})),a.createElement(K,{disabled:0===x.length,onClick:function(){return h(x)}},a.createElement(l,{as:N.PMT,css:{size:"icon",m:"-2px"}}))))))},Oe=["uid","username"];function Ie(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(r)return(r=r.call(e)).next.bind(r);if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return Me(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Me(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0;return function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function Me(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var Te=function(e){var t=e.deferred,r=s(),n=(0,a.useContext)(Vr).showProfile,o=(0,a.useContext)(O),i=o.currentUser,u=o.usersMetadata,d=(0,a.useContext)(j).approvedTangrams,m=(0,a.useContext)(L),p=m.tangramsStarredBy,g=m.tangramsCompletedBy,v=(0,a.useState)((function(){var e=window.localStorage.getItem("selectedLeaderboard");return["stars","completed","created"].includes(e)?e:"stars"})),h=v[0],b=v[1],y=(0,a.useMemo)((function(){for(var e,t={},r={},n={},a=Ie(d);!(e=a()).done;){var o=e.value,i=o.id,s=o.uid;for(var c in r[s]||(r[s]=0,t[s]=0),p[i])c!==s&&p[i][c]&&(t[s]+=1);for(var l in r[s]+=1,g[i])n[l]||(n[l]=0),n[l]+=1}return Object.keys(u).map((function(e){var a=u[e];return Object.assign({uid:e},a,{stars:t[e]||0,completed:n[e]||0,created:r[e]||0})}))}),[d,p,g,u]),E=(0,a.useMemo)((function(){if(y)return y.sort((function(e,t){return t[h]-e[h]}))}),[y,h]);return a.createElement(ae,{title:a.createElement(ce,null,r.formatMessage({id:"Leaderboard"})),onClose:function(){return t.reject(f.DIALOG_CLOSED_REASON)},css:{gap:3}},a.createElement(a.Fragment,null,a.createElement(we,{as:"select",value:h,onChange:function(e){b(e.target.value),window.localStorage.setItem("selectedLeaderboard",e.target.value)}},a.createElement("option",{value:"stars"},r.formatMessage({id:"Stars earned"})),a.createElement("option",{value:"completed"},r.formatMessage({id:"Completed tangrams"})),a.createElement("option",{value:"created"},r.formatMessage({id:"Created tangrams"}))),a.createElement(l,{css:{flex:"1",overflow:"auto",gap:2}},E.map((function(e,t){var r=e.uid,o=e.username,s=c(e,Oe);return a.createElement(l,{key:r,css:{flexDirection:"row",gap:2,alignItems:"center",fontSize:0===t?"1.6em":1===t?"1.4em":2===t?"1.2em":void 0},deps:[t]},a.createElement(ee,{uid:r,size:"badge",onClick:function(){return function(e){n(e)}(r)}}),a.createElement(oe,{css:{flex:"1",fontWeight:i&&i.uid===r?"bold":void 0},deps:[i,r]},o),a.createElement(oe,null,s[h],"stars"===h&&a.createElement(a.Fragment,null," ",a.createElement(fe,{icon:N.nae,css:{fill:"currentColor"}}))))})))))};function je(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var _e=r(181);function Re(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,a,o=[],i=!0,s=!1;try{for(r=r.call(e);!(i=(n=r.next()).done)&&(o.push(n.value),!t||o.length!==t);i=!0);}catch(c){s=!0,a=c}finally{try{i||null==r.return||r.return()}finally{if(s)throw a}}return o}}(e,t)||(0,_e.Z)(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function De(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return Le(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Le(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,i=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return i=e.done,e},e:function(e){s=!0,o=e},f:function(){try{i||null==r.return||r.return()}finally{if(s)throw o}}}}function Le(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var Pe=function(e){return"checkbox"===e.type},Ne=function(e){return e instanceof Date},Ue=function(e){return null==e},Fe=function(e){return"object"==typeof e},Ve=function(e){return!Ue(e)&&!Array.isArray(e)&&Fe(e)&&!Ne(e)},ze=function(e){return Ve(e)&&e.target?Pe(e.target)?e.target.checked:e.target.value:e},Be=function(e,t){return(0,g.Z)(e).some((function(e){return function(e){return e.substring(0,e.search(/.\d/))||e}(t)===e}))},Ge=function(e){return(e||[]).filter(Boolean)},qe=function(e){return void 0===e},We=function(e,t,r){if(Ve(e)&&t){var n=Ge(t.split(/[,[\].]+?/)).reduce((function(e,t){return Ue(e)?e:e[t]}),e);return qe(n)||n===e?qe(e[t])?r:e[t]:n}},Ye="blur",He="onBlur",$e="onChange",Ze="onSubmit",Je="onTouched",Xe="all",Ke="max",Qe="min",et="maxLength",tt="minLength",rt="pattern",nt="required",at="validate",ot=function(e,t){var r=Object.assign({},e);return delete r[t],r},it=(a.createContext(null),function(e,t,r){var n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];function a(a){return function(){if(a in e)return t[a]!==Xe&&(t[a]=!n||Xe),r&&(r[a]=!0),e[a]}}var o={};for(var i in e)Object.defineProperty(o,i,{get:a(i)});return o}),st=function(e){return Ve(e)&&!Object.keys(e).length},ct=function(e,t,r){var n=ot(e,"name");return st(n)||Object.keys(n).length>=Object.keys(t).length||Object.keys(n).find((function(e){return t[e]===(!r||Xe)}))},ut=function(e){return Array.isArray(e)?e:[e]};function lt(e){var t=a.useRef(e);t.current=e,a.useEffect((function(){var r=!e.disabled&&t.current.subject.subscribe({next:t.current.callback});return function(){return function(e){e&&e.unsubscribe()}(r)}}),[e.disabled])}var dt=function(e){return"string"==typeof e},ft=function(e,t,r,n){var a=Array.isArray(e);return dt(e)?(n&&t.watch.add(e),We(r,e)):a?e.map((function(e){return n&&t.watch.add(e),We(r,e)})):(n&&(t.watchAll=!0),r)},mt=function(e){return"function"==typeof e},pt=function(e){for(var t in e)if(mt(e[t]))return!0;return!1};var gt=function(e,t,r,n,a){return t?Object.assign(Object.assign({},r[e]),{types:Object.assign(Object.assign({},r[e]&&r[e].types?r[e].types:{}),je({},n,a||!0))}):{}},vt=function(e){return/^\w*$/.test(e)},ht=function(e){return Ge(e.replace(/["|']|\]/g,"").split(/\.|\[/))};function bt(e,t,r){for(var n=-1,a=vt(t)?[t]:ht(t),o=a.length,i=o-1;++n<o;){var s=a[n],c=r;if(n!==i){var u=e[s];c=Ve(u)||Array.isArray(u)?u:isNaN(+a[n+1])?{}:[]}e[s]=c,e=e[s]}return e}var yt=function e(t,r,n){var a,o=De(n||Object.keys(t));try{for(o.s();!(a=o.n()).done;){var i=a.value,s=We(t,i);if(s){var c=s._f,u=ot(s,"_f");if(c&&r(c.name)){if(c.ref.focus&&qe(c.ref.focus()))break;if(c.refs){c.refs[0].focus();break}}else Ve(u)&&e(u,r)}}}catch(l){o.e(l)}finally{o.f()}},Et=function(e,t,r){return!r&&(t.watchAll||t.watch.has(e)||(0,g.Z)(t.watch).some((function(t){return e.startsWith(t)&&/^\.\w+/.test(e.slice(t.length))})))};function wt(e){var t,r=Array.isArray(e);if(e instanceof Date)t=new Date(e);else if(e instanceof Set)t=new Set(e);else{if(!r&&!Ve(e))return e;for(var n in t=r?[]:{},e){if(mt(e[n])){t=e;break}t[n]=wt(e[n])}}return t}function xt(){var e=[];return{get observers(){return e},next:function(t){var r,n=De(e);try{for(n.s();!(r=n.n()).done;){r.value.next(t)}}catch(a){n.e(a)}finally{n.f()}},subscribe:function(t){return e.push(t),{unsubscribe:function(){e=e.filter((function(e){return e!==t}))}}},unsubscribe:function(){e=[]}}}var St=function(e){return Ue(e)||!Fe(e)};function Ct(e,t){if(St(e)||St(t))return e===t;if(Ne(e)&&Ne(t))return e.getTime()===t.getTime();var r=Object.keys(e),n=Object.keys(t);if(r.length!==n.length)return!1;for(var a=0,o=r;a<o.length;a++){var i=o[a],s=e[i];if(!n.includes(i))return!1;if("ref"!==i){var c=t[i];if(Ne(s)&&Ne(c)||Ve(s)&&Ve(c)||Array.isArray(s)&&Array.isArray(c)?!Ct(s,c):s!==c)return!1}}return!0}var kt=function(e){return{isOnSubmit:!e||e===Ze,isOnBlur:e===He,isOnChange:e===$e,isOnAll:e===Xe,isOnTouch:e===Je}},At=function(e){return"boolean"==typeof e},Ot=function(e){return"file"===e.type},It=function(e){return e instanceof HTMLElement},Mt=function(e){return"select-multiple"===e.type},Tt=function(e){return"radio"===e.type},jt=function(e){return Tt(e)||Pe(e)},_t="undefined"!=typeof window&&void 0!==window.HTMLElement&&"undefined"!=typeof document,Rt=function(e){return It(e)&&document.contains(e)};function Dt(e,t){var r,n=vt(t)?[t]:ht(t),a=1==n.length?e:function(e,t){for(var r=t.slice(0,-1).length,n=0;n<r;)e=qe(e)?n++:e[t[n++]];return e}(e,n),o=n[n.length-1];a&&delete a[o];for(var i=0;i<n.slice(0,-1).length;i++){var s=-1,c=void 0,u=n.slice(0,-(i+1)),l=u.length-1;for(i>0&&(r=e);++s<u.length;){var d=u[s];c=c?c[d]:e[d],l===s&&(Ve(c)&&st(c)||Array.isArray(c)&&!c.filter((function(e){return Ve(e)&&!st(e)||At(e)})).length)&&(r?delete r[d]:delete e[d]),r=c}}return e}function Lt(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=Array.isArray(e);if(Ve(e)||r)for(var n in e)Array.isArray(e[n])||Ve(e[n])&&!pt(e[n])?(t[n]=Array.isArray(e[n])?[]:{},Lt(e[n],t[n])):Ue(e[n])||(t[n]=!0);return t}function Pt(e,t,r){var n=Array.isArray(e);if(Ve(e)||n)for(var a in e)Array.isArray(e[a])||Ve(e[a])&&!pt(e[a])?qe(t)||St(r[a])?r[a]=Array.isArray(e[a])?Lt(e[a],[]):Object.assign({},Lt(e[a])):Pt(e[a],Ue(t)?{}:t[a],r[a]):r[a]=!Ct(e[a],t[a]);return r}var Nt=function(e,t){return Pt(e,t,Lt(t))},Ut={value:!1,isValid:!1},Ft={value:!0,isValid:!0},Vt=function(e){if(Array.isArray(e)){if(e.length>1){var t=e.filter((function(e){return e&&e.checked&&!e.disabled})).map((function(e){return e.value}));return{value:t,isValid:!!t.length}}return e[0].checked&&!e[0].disabled?e[0].attributes&&!qe(e[0].attributes.value)?qe(e[0].value)||""===e[0].value?Ft:{value:e[0].value,isValid:!0}:Ft:Ut}return Ut},zt=function(e,t){var r=t.valueAsNumber,n=t.valueAsDate,a=t.setValueAs;return qe(e)?e:r?""===e?NaN:+e:n&&dt(e)?new Date(e):a?a(e):e},Bt={isValid:!1,value:null},Gt=function(e){return Array.isArray(e)?e.reduce((function(e,t){return t&&t.checked&&!t.disabled?{isValid:!0,value:t.value}:e}),Bt):Bt};function qt(e){var t=e.ref;if(!(e.refs?e.refs.every((function(e){return e.disabled})):t.disabled))return Ot(t)?t.files:Tt(t)?Gt(e.refs).value:Mt(t)?(0,g.Z)(t.selectedOptions).map((function(e){return e.value})):Pe(t)?Vt(e.refs).value:zt(qe(t.value)?e.ref.value:t.value,e)}var Wt=function(e,t,r,n){var a,o={},i=De(e);try{for(i.s();!(a=i.n()).done;){var s=a.value,c=We(t,s);c&&bt(o,s,c._f)}}catch(u){i.e(u)}finally{i.f()}return{criteriaMode:r,names:(0,g.Z)(e),fields:o,shouldUseNativeValidation:n}},Yt=function(e){return e instanceof RegExp},Ht=function(e){return qe(e)?void 0:Yt(e)?e.source:Ve(e)?Yt(e.value)?e.value.source:e.value:e},$t=function(e){return e.mount&&(e.required||e.min||e.max||e.maxLength||e.minLength||e.pattern||e.validate)};function Zt(e,t,r){var n=We(e,r);if(n||vt(r))return{error:n,name:r};for(var a=r.split(".");a.length;){var o=a.join("."),i=We(t,o),s=We(e,o);if(i&&!Array.isArray(i)&&r!==o)return{name:r};if(s&&s.type)return{name:o,error:s};a.pop()}return{name:r}}var Jt=function(e,t,r,n,a){return!a.isOnAll&&(!r&&a.isOnTouch?!(t||e):(r?n.isOnBlur:a.isOnBlur)?!e:!(r?n.isOnChange:a.isOnChange)||e)},Xt=function(e,t){return!Ge(We(e,t)).length&&Dt(e,t)},Kt=function(e){return dt(e)||a.isValidElement(e)};function Qt(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"validate";if(Kt(e)||Array.isArray(e)&&e.every(Kt)||At(e)&&!e)return{type:r,message:Kt(e)?e:"",ref:t}}var er=function(e){return Ve(e)&&!Yt(e)?e:{value:e,message:""}},tr=function(){var e=p(h().mark((function e(t,r,n,a){var o,i,s,c,u,l,d,f,m,p,g,v,b,y,E,w,x,S,C,k,A,O,I,M,T,j,_,R,D,L,P,N,U,F,V,z,B,G,q,W,Y,H,$,Z;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=t._f,i=o.ref,s=o.refs,c=o.required,u=o.maxLength,l=o.minLength,d=o.min,f=o.max,m=o.pattern,p=o.validate,g=o.name,v=o.valueAsNumber,b=o.mount,y=o.disabled,b&&!y){e.next=3;break}return e.abrupt("return",{});case 3:if(E=s?s[0]:i,w=function(e){a&&E.reportValidity&&(E.setCustomValidity(At(e)?"":e||" "),E.reportValidity())},x={},S=Tt(i),C=Pe(i),k=S||C,A=(v||Ot(i))&&!i.value||""===r||Array.isArray(r)&&!r.length,O=gt.bind(null,g,n,x),I=function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:et,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:tt,o=e?t:r;x[g]=Object.assign({type:e?n:a,message:o,ref:i},O(e?n:a,o))},!c||!(!k&&(A||Ue(r))||At(r)&&!r||C&&!Vt(s).isValid||S&&!Gt(s).isValid)){e.next=19;break}if(M=Kt(c)?{value:!!c,message:c}:er(c),T=M.value,j=M.message,!T){e.next=19;break}if(x[g]=Object.assign({type:nt,message:j,ref:E},O(nt,j)),n){e.next=19;break}return w(j),e.abrupt("return",x);case 19:if(A||Ue(d)&&Ue(f)){e.next=28;break}if(D=er(f),L=er(d),isNaN(r)?(N=i.valueAsDate||new Date(r),dt(D.value)&&(_=N>new Date(D.value)),dt(L.value)&&(R=N<new Date(L.value))):(P=i.valueAsNumber||parseFloat(r),Ue(D.value)||(_=P>D.value),Ue(L.value)||(R=P<L.value)),!_&&!R){e.next=28;break}if(I(!!_,D.message,L.message,Ke,Qe),n){e.next=28;break}return w(x[g].message),e.abrupt("return",x);case 28:if(!u&&!l||A||!dt(r)){e.next=38;break}if(U=er(u),F=er(l),V=!Ue(U.value)&&r.length>U.value,z=!Ue(F.value)&&r.length<F.value,!V&&!z){e.next=38;break}if(I(V,U.message,F.message),n){e.next=38;break}return w(x[g].message),e.abrupt("return",x);case 38:if(!m||A||!dt(r)){e.next=45;break}if(B=er(m),G=B.value,q=B.message,!Yt(G)||r.match(G)){e.next=45;break}if(x[g]=Object.assign({type:rt,message:q,ref:i},O(rt,q)),n){e.next=45;break}return w(q),e.abrupt("return",x);case 45:if(!p){e.next=79;break}if(!mt(p)){e.next=58;break}return e.next=49,p(r);case 49:if(W=e.sent,!(Y=Qt(W,E))){e.next=56;break}if(x[g]=Object.assign(Object.assign({},Y),O(at,Y.message)),n){e.next=56;break}return w(Y.message),e.abrupt("return",x);case 56:e.next=79;break;case 58:if(!Ve(p)){e.next=79;break}H={},e.t0=h().keys(p);case 61:if((e.t1=e.t0()).done){e.next=75;break}if($=e.t1.value,st(H)||n){e.next=65;break}return e.abrupt("break",75);case 65:return e.t2=Qt,e.next=68,p[$](r);case 68:e.t3=e.sent,e.t4=E,e.t5=$,(Z=(0,e.t2)(e.t3,e.t4,e.t5))&&(H=Object.assign(Object.assign({},Z),O($,Z.message)),w(Z.message),n&&(x[g]=H)),e.next=61;break;case 75:if(st(H)){e.next=79;break}if(x[g]=Object.assign({ref:E},H),n){e.next=79;break}return e.abrupt("return",x);case 79:return w(!0),e.abrupt("return",x);case 81:case"end":return e.stop()}}),e)})));return function(t,r,n,a){return e.apply(this,arguments)}}(),rr={mode:Ze,reValidateMode:$e,shouldFocusError:!0};function nr(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=Object.assign(Object.assign({},rr),t),n={isDirty:!1,isValidating:!1,dirtyFields:{},isSubmitted:!1,submitCount:0,touchedFields:{},isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,errors:{}},a={},o=r.defaultValues||{},i=r.shouldUnregister?{}:wt(o),s={action:!1,mount:!1,watch:!1},c={mount:new Set,unMount:new Set,array:new Set,watch:new Set},u=0,l={},d={isDirty:!1,dirtyFields:!1,touchedFields:!1,isValidating:!1,isValid:!1,errors:!1},f={watch:xt(),array:xt(),state:xt()},m=kt(r.mode),v=kt(r.reValidateMode),b=r.criteriaMode===Xe,y=function(e,t){return function(){for(var r=arguments.length,n=new Array(r),a=0;a<r;a++)n[a]=arguments[a];clearTimeout(u),u=window.setTimeout((function(){return e.apply(void 0,n)}),t)}},E=function(){var e=p(h().mark((function e(t){var o;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=!1,!d.isValid){e.next=15;break}if(!r.resolver){e.next=10;break}return e.t1=st,e.next=6,A();case 6:e.t2=e.sent.errors,e.t0=(0,e.t1)(e.t2),e.next=13;break;case 10:return e.next=12,I(a,!0);case 12:e.t0=e.sent;case 13:o=e.t0,t||o===n.isValid||(n.isValid=o,f.state.next({isValid:o}));case 15:return e.abrupt("return",o);case 16:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),w=function(e,t,r){var c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],u=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],l=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];if(s.action=!0,l&&We(a,e)){var m=t(We(a,e),r.argA,r.argB);u&&bt(a,e,m)}if(Array.isArray(We(n.errors,e))){var p=t(We(n.errors,e),r.argA,r.argB);u&&bt(n.errors,e,p),Xt(n.errors,e)}if(d.touchedFields&&We(n.touchedFields,e)){var g=t(We(n.touchedFields,e),r.argA,r.argB);u&&bt(n.touchedFields,e,g),Xt(n.touchedFields,e)}(d.dirtyFields||d.isDirty)&&(n.dirtyFields=Nt(o,i)),f.state.next({isDirty:T(e,c),dirtyFields:n.dirtyFields,errors:n.errors,isValid:n.isValid})},x=function(e,t){return bt(n.errors,e,t),f.state.next({errors:n.errors})},S=function(e,t,r){var n=We(a,e);if(n){var c=We(i,e,We(o,e));qe(c)||r&&r.defaultChecked||t?bt(i,e,t?c:qt(n._f)):R(e,c)}s.mount&&E()},C=function(e,t,r){var a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],i=!1,s={name:e},c=We(n.touchedFields,e);if(d.isDirty){var u=n.isDirty;n.isDirty=s.isDirty=T(),i=u!==s.isDirty}if(d.dirtyFields&&!r){var l=We(n.dirtyFields,e),m=Ct(We(o,e),t);m?Dt(n.dirtyFields,e):bt(n.dirtyFields,e,!0),s.dirtyFields=n.dirtyFields,i=i||l!==We(n.dirtyFields,e)}return r&&!c&&(bt(n.touchedFields,e,r),s.touchedFields=n.touchedFields,i=i||d.touchedFields&&c!==r),i&&a&&f.state.next(s),i?s:{}},k=function(){var r=p(h().mark((function r(a,o,i,s,c){var m,p,g;return h().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:m=We(n.errors,o),p=d.isValid&&n.isValid!==i,t.delayError&&s?(e=e||y(x,t.delayError))(o,s):(clearTimeout(u),s?bt(n.errors,o,s):Dt(n.errors,o)),(s?Ct(m,s):!m)&&st(c)&&!p||a||(g=Object.assign(Object.assign(Object.assign({},c),p?{isValid:i}:{}),{errors:n.errors,name:o}),n=Object.assign(Object.assign({},n),g),f.state.next(g)),l[o]--,d.isValidating&&!l[o]&&(f.state.next({isValidating:!1}),l={});case 6:case"end":return r.stop()}}),r)})));return function(e,t,n,a,o){return r.apply(this,arguments)}}(),A=function(){var e=p(h().mark((function e(t){return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!r.resolver){e.next=6;break}return e.next=3,r.resolver(Object.assign({},i),r.context,Wt(t||c.mount,a,r.criteriaMode,r.shouldUseNativeValidation));case 3:e.t0=e.sent,e.next=7;break;case 6:e.t0={};case 7:return e.abrupt("return",e.t0);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),O=function(){var e=p(h().mark((function e(t){var r,a,o,i,s,c;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,A();case 2:if(r=e.sent,a=r.errors,t){o=De(t);try{for(o.s();!(i=o.n()).done;)s=i.value,(c=We(a,s))?bt(n.errors,s,c):Dt(n.errors,s)}catch(u){o.e(u)}finally{o.f()}}else n.errors=a;return e.abrupt("return",a);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),I=function(){var e=p(h().mark((function e(t,a){var o,s,c,u,l,d,f=arguments;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:o=f.length>2&&void 0!==f[2]?f[2]:{valid:!0},e.t0=h().keys(t);case 2:if((e.t1=e.t0()).done){e.next=23;break}if(s=e.t1.value,!(c=t[s])){e.next=21;break}if(u=c._f,l=ot(c,"_f"),!u){e.next=17;break}return e.next=11,tr(c,We(i,u.name),b,r.shouldUseNativeValidation);case 11:if(!(d=e.sent)[u.name]){e.next=16;break}if(o.valid=!1,!a){e.next=16;break}return e.abrupt("break",23);case 16:a||(d[u.name]?bt(n.errors,u.name,d[u.name]):Dt(n.errors,u.name));case 17:if(e.t2=l,!e.t2){e.next=21;break}return e.next=21,I(l,a,o);case 21:e.next=2;break;case 23:return e.abrupt("return",o.valid);case 24:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),M=function(){var e,t=De(c.unMount);try{for(t.s();!(e=t.n()).done;){var r=e.value,n=We(a,r);n&&(n._f.refs?n._f.refs.every((function(e){return!Rt(e)})):!Rt(n._f.ref))&&B(r)}}catch(o){t.e(o)}finally{t.f()}c.unMount=new Set},T=function(e,t){return e&&t&&bt(i,e,t),!Ct(U(),o)},j=function(e,t,r){var n=Object.assign({},s.mount?i:qe(t)?o:dt(e)?je({},e,t):t);return ft(e,c,n,r)},_=function(e){return We(s.mount?i:o,e,t.shouldUnregister?We(o,e,[]):[])},R=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=We(a,e),o=t;if(n){var s=n._f;s&&(bt(i,e,zt(t,s)),o=_t&&It(s.ref)&&Ue(t)?"":t,Mt(s.ref)?(0,g.Z)(s.ref.options).forEach((function(e){return e.selected=o.includes(e.value)})):s.refs?Pe(s.ref)?s.refs.length>1?s.refs.forEach((function(e){return e.checked=Array.isArray(o)?!!o.find((function(t){return t===e.value})):o===e.value})):s.refs[0].checked=!!o:s.refs.forEach((function(e){return e.checked=e.value===o})):Ot(s.ref)||(s.ref.value=o))}(r.shouldDirty||r.shouldTouch)&&C(e,o,r.shouldTouch),r.shouldValidate&&N(e)},D=function e(t,r,n){for(var o in r){var i=r[o],s="".concat(t,".").concat(o),u=We(a,s);!c.array.has(t)&&St(i)&&(!u||u._f)||Ne(i)?R(s,i,n):e(s,i,n)}},L=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=We(a,e),u=c.array.has(e);bt(i,e,t),u?(f.array.next({name:e,values:i}),(d.isDirty||d.dirtyFields)&&r.shouldDirty&&(n.dirtyFields=Nt(o,i),f.state.next({name:e,dirtyFields:n.dirtyFields,isDirty:T(e,t)}))):!s||s._f||Ue(t)?R(e,t,r):D(e,t,r),Et(e,c)&&f.state.next({}),f.watch.next({name:e})},P=function(){var e=p(h().mark((function e(t){var o,s,u,p,g,y,w,x,S,O,I,M,T,j,_;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=t.target,s=o.name,!(u=We(a,s))){e.next=39;break}if(y=o.type?qt(u._f):ze(t),w=t.type===Ye,x=!$t(u._f)&&!r.resolver&&!We(n.errors,s)&&!u._f.deps||Jt(w,We(n.touchedFields,s),n.isSubmitted,v,m),S=Et(s,c,w),w?u._f.onBlur&&u._f.onBlur(t):u._f.onChange&&u._f.onChange(t),bt(i,s,y),O=C(s,y,w,!1),I=!st(O)||S,!w&&f.watch.next({name:s,type:t.type}),!x){e.next=15;break}return e.abrupt("return",I&&f.state.next(Object.assign({name:s},S?{}:O)));case 15:if(!w&&S&&f.state.next({}),l[s]=(l[s],1),d.isValidating&&f.state.next({isValidating:!0}),!r.resolver){e.next=30;break}return e.next=21,A([s]);case 21:M=e.sent,T=M.errors,j=Zt(n.errors,a,s),_=Zt(T,a,j.name||s),p=_.error,s=_.name,g=st(T),e.next=37;break;case 30:return e.next=32,tr(u,We(i,s),b,r.shouldUseNativeValidation);case 32:return e.t0=s,p=e.sent[e.t0],e.next=36,E(!0);case 36:g=e.sent;case 37:u._f.deps&&N(u._f.deps),k(!1,s,g,p,O);case 39:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),N=function(){var e=p(h().mark((function e(t){var o,i,s,u,l,m=arguments;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=m.length>1&&void 0!==m[1]?m[1]:{},u=ut(t),f.state.next({isValidating:!0}),!r.resolver){e.next=11;break}return e.next=6,O(qe(t)?t:u);case 6:l=e.sent,i=st(l),s=t?!u.some((function(e){return We(l,e)})):i,e.next=21;break;case 11:if(!t){e.next=18;break}return e.next=14,Promise.all(u.map(function(){var e=p(h().mark((function e(t){var r;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=We(a,t),e.next=3,I(r&&r._f?je({},t,r):r);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 14:((s=e.sent.every(Boolean))||n.isValid)&&E(),e.next=21;break;case 18:return e.next=20,I(a);case 20:s=i=e.sent;case 21:return f.state.next(Object.assign(Object.assign(Object.assign({},!dt(t)||d.isValid&&i!==n.isValid?{}:{name:t}),r.resolver?{isValid:i}:{}),{errors:n.errors,isValidating:!1})),o.shouldFocus&&!s&&yt(a,(function(e){return We(n.errors,e)}),t?u:c.mount),e.abrupt("return",s);case 24:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),U=function(e){var t=Object.assign(Object.assign({},o),s.mount?i:{});return qe(e)?t:dt(e)?We(t,e):e.map((function(e){return We(t,e)}))},F=function(e){e?ut(e).forEach((function(e){return Dt(n.errors,e)})):n.errors={},f.state.next({errors:n.errors,isValid:!0})},V=function(e,t,r){var o=(We(a,e,{_f:{}})._f||{}).ref;bt(n.errors,e,Object.assign(Object.assign({},t),{ref:o})),f.state.next({name:e,errors:n.errors,isValid:!1}),r&&r.shouldFocus&&o&&o.focus&&o.focus()},z=function(e,t){return mt(e)?f.watch.subscribe({next:function(r){return e(j(void 0,t),r)}}):j(e,t,!0)},B=function(e){var t,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},u=De(e?ut(e):c.mount);try{for(u.s();!(t=u.n()).done;){var l=t.value;c.mount.delete(l),c.array.delete(l),We(a,l)&&(s.keepValue||(Dt(a,l),Dt(i,l)),!s.keepError&&Dt(n.errors,l),!s.keepDirty&&Dt(n.dirtyFields,l),!s.keepTouched&&Dt(n.touchedFields,l),!r.shouldUnregister&&!s.keepDefaultValue&&Dt(o,l))}}catch(d){u.e(d)}finally{u.f()}f.watch.next({}),f.state.next(Object.assign(Object.assign({},n),s.keepDirty?{isDirty:T()}:{})),!s.keepIsValid&&E()},G=function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=We(a,t);return bt(a,t,{_f:Object.assign(Object.assign(Object.assign({},o&&o._f?o._f:{ref:{name:t}}),{name:t,mount:!0}),n)}),c.mount.add(t),!qe(n.value)&&!n.disabled&&bt(i,t,We(i,t,n.value)),o?At(n.disabled)&&bt(i,t,n.disabled?void 0:We(i,t,qt(o._f))):S(t,!0),Object.assign(Object.assign(Object.assign({},At(n.disabled)?{disabled:n.disabled}:{}),r.shouldUseNativeValidation?{required:!!n.required,min:Ht(n.min),max:Ht(n.max),minLength:Ht(n.minLength),maxLength:Ht(n.maxLength),pattern:Ht(n.pattern)}:{}),{name:t,onChange:P,onBlur:P,ref:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(i){if(i){e(t,n),o=We(a,t);var u=qe(i.value)&&i.querySelectorAll&&i.querySelectorAll("input,select,textarea")[0]||i,l=jt(u);if(u===o._f.ref||l&&Ge(o._f.refs).find((function(e){return e===u})))return;bt(a,t,{_f:l?Object.assign(Object.assign({},o._f),{refs:[].concat((0,g.Z)(Ge(o._f.refs).filter(Rt)),[u]),ref:{type:u.type,name:t}}):Object.assign(Object.assign({},o._f),{ref:u})}),!n.disabled&&S(t,!1,u)}else(o=We(a,t,{}))._f&&(o._f.mount=!1),(r.shouldUnregister||n.shouldUnregister)&&(!Be(c.array,t)||!s.action)&&c.unMount.add(t)}))})},q=function(e,t){return function(){var o=p(h().mark((function o(s){var u,l,d,m,p;return h().wrap((function(o){for(;;)switch(o.prev=o.next){case 0:if(s&&(s.preventDefault&&s.preventDefault(),s.persist&&s.persist()),u=!0,l=r.shouldUnregister?wt(i):Object.assign({},i),f.state.next({isSubmitting:!0}),o.prev=4,!r.resolver){o.next=15;break}return o.next=8,A();case 8:d=o.sent,m=d.errors,p=d.values,n.errors=m,l=p,o.next=17;break;case 15:return o.next=17,I(a);case 17:if(!st(n.errors)||!Object.keys(n.errors).every((function(e){return We(l,e)}))){o.next=23;break}return f.state.next({errors:{},isSubmitting:!0}),o.next=21,e(l,s);case 21:o.next=28;break;case 23:if(o.t0=t,!o.t0){o.next=27;break}return o.next=27,t(n.errors,s);case 27:r.shouldFocusError&&yt(a,(function(e){return We(n.errors,e)}),c.mount);case 28:o.next=34;break;case 30:throw o.prev=30,o.t1=o.catch(4),u=!1,o.t1;case 34:return o.prev=34,n.isSubmitted=!0,f.state.next({isSubmitted:!0,isSubmitting:!1,isSubmitSuccessful:st(n.errors)&&u,submitCount:n.submitCount+1,errors:n.errors}),o.finish(34);case 38:case"end":return o.stop()}}),o,null,[[4,30,34,38]])})));return function(e){return o.apply(this,arguments)}}()},W=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};qe(t.defaultValue)?L(e,We(o,e)):(L(e,t.defaultValue),bt(o,e,t.defaultValue)),t.keepTouched||Dt(n.touchedFields,e),t.keepDirty||(Dt(n.dirtyFields,e),n.isDirty=t.defaultValue?T(e,We(o,e)):T()),t.keepError||(Dt(n.errors,e),d.isValid&&E()),f.state.next(Object.assign({},n))},Y=function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},u=e||o,l=wt(u),m=st(e)?o:l;if(r.keepDefaultValues||(o=u),!r.keepValues){if(_t){var p,g=De(c.mount);try{for(g.s();!(p=g.n()).done;){var v=p.value,h=We(a,v);if(h&&h._f){var b=Array.isArray(h._f.refs)?h._f.refs[0]:h._f.ref;try{It(b)&&b.closest("form").reset();break}catch(y){}}}}catch(E){g.e(E)}finally{g.f()}}i=t.shouldUnregister?r.keepDefaultValues?wt(o):{}:l,a={},f.watch.next({values:m}),f.array.next({values:m})}c={mount:new Set,unMount:new Set,array:new Set,watch:new Set,watchAll:!1,focus:""},f.state.next({submitCount:r.keepSubmitCount?n.submitCount:0,isDirty:r.keepDirty?n.isDirty:!!r.keepDefaultValues&&!Ct(e,o),isSubmitted:!!r.keepIsSubmitted&&n.isSubmitted,dirtyFields:r.keepDirty?n.dirtyFields:r.keepDefaultValues&&e?Object.entries(e).reduce((function(e,t){var r=Re(t,2),n=r[0],a=r[1];return Object.assign(Object.assign({},e),je({},n,a!==We(o,n)))}),{}):{},touchedFields:r.keepTouched?n.touchedFields:{},errors:r.keepErrors?n.errors:{},isSubmitting:!1,isSubmitSuccessful:!1}),s.mount=!d.isValid||!!r.keepIsValid,s.watch=!!t.shouldUnregister},H=function(e){var t=We(a,e)._f;(t.ref.focus?t.ref:t.refs[0]).focus()};return{control:{register:G,unregister:B,_executeSchema:A,_getWatch:j,_getDirty:T,_updateValid:E,_removeUnmounted:M,_updateFieldArray:w,_getFieldArray:_,_subjects:f,_proxyFormState:d,get _fields(){return a},set _fields(e){a=e},get _formValues(){return i},set _formValues(e){i=e},get _stateFlags(){return s},set _stateFlags(e){s=e},get _defaultValues(){return o},set _defaultValues(e){o=e},get _names(){return c},set _names(e){c=e},get _formState(){return n},set _formState(e){n=e},get _options(){return r},set _options(e){r=Object.assign(Object.assign({},r),e)}},trigger:N,register:G,handleSubmit:q,watch:z,setValue:L,getValues:U,reset:Y,resetField:W,clearErrors:F,unregister:B,setError:V,setFocus:H}}function ar(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=a.useRef(),r=a.useState({isDirty:!1,isValidating:!1,dirtyFields:{},isSubmitted:!1,submitCount:0,touchedFields:{},isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,errors:{}}),n=Re(r,2),o=n[0],i=n[1];t.current?t.current.control._options=e:t.current=Object.assign(Object.assign({},nr(e)),{formState:o});var s=t.current.control;return lt({subject:s._subjects.state,callback:function(e){ct(e,s._proxyFormState,!0)&&(s._formState=Object.assign(Object.assign({},s._formState),e),i(Object.assign({},s._formState)))}}),a.useEffect((function(){s._stateFlags.mount||(s._proxyFormState.isValid&&s._updateValid(),s._stateFlags.mount=!0),s._stateFlags.watch&&(s._stateFlags.watch=!1,s._subjects.state.next({})),s._removeUnmounted()})),t.current.formState=it(o,s._proxyFormState),t.current}var or=function(e){var t=e.setTab,r=s(),n=(0,a.useContext)(S),o=ar(),i=o.handleSubmit,c=o.register,u=o.setError,d=o.formState,f=(0,a.useCallback)(function(){var e=p(h().mark((function e(a){var o;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=a.email,e.prev=1,e.next=4,E.auth().sendPasswordResetEmail(o);case 4:t("signin"),n(r.formatMessage({id:"Reset password email sent"})),e.next=16;break;case 8:e.prev=8,e.t0=e.catch(1),e.t1=e.t0.code,e.next="auth/invalid-email"===e.t1||"auth/user-not-found"===e.t1||"auth/user-disabled"===e.t1?13:15;break;case 13:return u("email",{type:"invalid",message:r.formatMessage({id:"Unknown email address"})}),e.abrupt("break",16);case 15:n(r.formatMessage({id:"An error occured, please retry later"},{email:o}));case 16:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(t){return e.apply(this,arguments)}}(),[u,r,n,t]);return a.createElement(l,{as:"form",name:"reset",onSubmit:i(f),css:{gap:4}},a.createElement(l,{css:{gap:2}},a.createElement("label",null,r.formatMessage({id:"Email address"})),a.createElement(we,Object.assign({type:"email"},c("email",{required:r.formatMessage({id:"Email address is required"})}))),d.errors.email&&a.createElement(ie,null,d.errors.email.message)),a.createElement(l,{css:{gap:3}},a.createElement(K,{type:"submit",disabled:d.isSubmitting},r.formatMessage({id:"Send the reset mail!"})),a.createElement(l,{css:{alignItems:"center"}},a.createElement(de,{onClick:function(){return t("signin")}},r.formatMessage({id:"Back"})))))},ir=function(e){var t=e.onSignUp,r=e.setTab,n=s(),o=ar(),i=o.handleSubmit,c=o.register,u=o.watch,d=o.setError,f=o.formState,m=u("password"),g=(0,a.useCallback)(function(){var e=p(h().mark((function e(r){var a,o,i,s,c,u;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=r.email,o=r.username,i=r.password,e.prev=1,e.next=4,E.auth().createUserWithEmailAndPassword(a,i);case 4:return s=e.sent,c=s.user,u={username:o,signupDate:Date.now()},e.next=9,E.firestore().collection("users").doc(c.uid).set(u);case 9:t(Object.assign({uid:c.uid},u,{firebaseUser:c})),e.next=24;break;case 12:e.prev=12,e.t0=e.catch(1),e.t1=e.t0.code,e.next="auth/weak-password"===e.t1?17:"auth/email-already-in-use"===e.t1?19:"auth/invalid-email"===e.t1?21:23;break;case 17:return d("password",{type:"weakPassword",message:n.formatMessage({id:"Password is too weak"})}),e.abrupt("break",24);case 19:return d("email",{type:"alreadyExists",message:n.formatMessage({id:"Email address already in use"})}),e.abrupt("break",24);case 21:return d("email",{type:"invalid",message:n.formatMessage({id:"Invalid email address"})}),e.abrupt("break",24);case 23:return e.abrupt("return");case 24:case"end":return e.stop()}}),e,null,[[1,12]])})));return function(t){return e.apply(this,arguments)}}(),[t,d,n]);return a.createElement(l,{as:"form",name:"signup",autoComplete:"off",onSubmit:i(g),css:{gap:4}},a.createElement(l,{css:{gap:3}},a.createElement(l,{css:{gap:2}},a.createElement("label",null,n.formatMessage({id:"Username"})),a.createElement(we,c("username",{required:n.formatMessage({id:"Username is required"})})),f.errors.username&&a.createElement(ie,null,f.errors.username.message)),a.createElement(l,{css:{gap:2}},a.createElement("label",null,n.formatMessage({id:"Email address"})),a.createElement(we,Object.assign({type:"email"},c("email",{required:n.formatMessage({id:"Email address is required"})}))),f.errors.email&&a.createElement(ie,null,f.errors.email.message)),a.createElement(l,{css:{gap:2}},a.createElement("label",null,n.formatMessage({id:"Password"})),a.createElement(we,Object.assign({autoComplete:"new-password",type:"password"},c("password",{required:n.formatMessage({id:"Password is required"})}))),f.errors.password&&a.createElement(ie,null,f.errors.password.message)),a.createElement(l,{css:{gap:2}},a.createElement("label",null,n.formatMessage({id:"Confirm password"})),a.createElement(we,Object.assign({autoComplete:"off",type:"password"},c("passwordConfirm",{required:"Password is required",validate:function(e){return e===m||n.formatMessage({id:"Passwords must match"})}}))),f.errors.passwordConfirm&&a.createElement(ie,null,f.errors.passwordConfirm.message))),a.createElement(l,{css:{gap:3}},a.createElement(K,{disabled:f.isSubmitting,type:"submit"},n.formatMessage({id:"Sign me up!"})),a.createElement(l,{css:{alignItems:"center"}},a.createElement(de,{onClick:function(){return r("signin")}},n.formatMessage({id:"I already have an account"})))))},sr=function(e){var t=e.onSignIn,r=e.setTab,n=s(),o=ar(),i=o.handleSubmit,c=o.register,u=o.setError,d=o.formState,f=(0,a.useCallback)(function(){var e=p(h().mark((function e(r){var a,o,i,s,c,l;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=r.email,o=r.password,e.prev=1,e.next=4,E.auth().signInWithEmailAndPassword(a,o);case 4:return i=e.sent,s=i.user,e.next=8,E.firestore().collection("users").doc(s.uid).get();case 8:c=e.sent,l=c.data(),t(Object.assign({uid:s.uid},l,{firebaseUser:s})),e.next=23;break;case 13:e.prev=13,e.t0=e.catch(1),e.t1=e.t0.code,e.next="auth/invalid-email"===e.t1||"auth/user-not-found"===e.t1||"auth/user-disabled"===e.t1?18:"auth/wrong-password"===e.t1?20:22;break;case 18:return u("email",{type:"invalid",message:n.formatMessage({id:"Unknown email address"})}),e.abrupt("break",23);case 20:return u("password",{type:"mismatch",message:n.formatMessage({id:"Incorrect password"})}),e.abrupt("break",23);case 22:return e.abrupt("return");case 23:case"end":return e.stop()}}),e,null,[[1,13]])})));return function(t){return e.apply(this,arguments)}}(),[t,u,n]);return a.createElement(l,{as:"form",name:"signin",onSubmit:i(f),css:{gap:4}},a.createElement(l,{css:{gap:3}},a.createElement(l,{css:{gap:2}},a.createElement("label",null,n.formatMessage({id:"Email address"})),a.createElement(we,Object.assign({type:"email"},c("email",{required:n.formatMessage({id:"Email address is required"})}))),d.errors.email&&a.createElement(ie,null,d.errors.email.message)),a.createElement(l,{css:{gap:2}},a.createElement("label",null,n.formatMessage({id:"Password"})),a.createElement(we,Object.assign({type:"password"},c("password",{required:n.formatMessage({id:"Password is required"})}))),d.errors.password&&a.createElement(ie,null,d.errors.password.message),a.createElement(de,{css:{alignSelf:"flex-end",fontSize:2},onClick:function(){return r("reset")}},n.formatMessage({id:"Forgot password?"})))),a.createElement(l,{css:{gap:3}},a.createElement(K,{type:"submit",disabled:d.isSubmitting},n.formatMessage({id:"Sign me in!"})),a.createElement(l,{css:{alignItems:"center"}},a.createElement(de,{onClick:function(){return r("signup")}},n.formatMessage({id:"I don't have an account"})))))},cr=function(e){var t=e.deferred,r=s(),n=(0,a.useContext)(S),o=(0,a.useState)("signup"),i=o[0],c=o[1],u=function(e){t.resolve(e),n(r.formatMessage({id:"Logged in as {username}"},{username:e.username}))};return a.createElement(ae,{title:"signup"===i?a.createElement(ce,null,r.formatMessage({id:"Create your account"})):"signin"===i?a.createElement(ce,null,r.formatMessage({id:"Connect to your account"})):a.createElement(ce,null,r.formatMessage({id:"Reset your password"})),onClose:function(){return t.reject(f.DIALOG_CLOSED_REASON)}},"signup"===i?a.createElement(ir,{onSignUp:u,setTab:c}):"signin"===i?a.createElement(sr,{onSignIn:u,setTab:c}):a.createElement(or,{setTab:c}))},ur=r(5241);function lr(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(r)return(r=r.call(e)).next.bind(r);if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return dr(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return dr(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0;return function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function dr(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var fr=function(e){var t=e.currentUser,r=e.onClose,n=s(),o=(0,a.useContext)(O).updateEmail,i=(0,a.useContext)(S),c=ar(),u=c.handleSubmit,d=c.register,f=c.setError,m=c.formState,g=(0,a.useCallback)(function(){var e=p(h().mark((function e(a){var s,c;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=a.password,c=a.newEmail,e.prev=1,e.next=4,o(t,s,c);case 4:i(n.formatMessage({id:"Email address updated successfuly"})),r(),e.next=21;break;case 8:e.prev=8,e.t0=e.catch(1),e.t1=e.t0.code,e.next="auth/email-already-in-use"===e.t1?13:"auth/invalid-email"===e.t1?15:"auth/wrong-password"===e.t1?17:19;break;case 13:return f("newEmail",{type:"alreadyExists",message:n.formatMessage({id:"Email address already in use"})}),e.abrupt("break",21);case 15:return f("newEmail",{type:"invalid",message:n.formatMessage({id:"Invalid email address"})}),e.abrupt("break",21);case 17:return f("password",{type:"mismatch",message:n.formatMessage({id:"Incorrect password"})}),e.abrupt("break",21);case 19:throw i(n.formatMessage({id:"An error occured, please retry later"})),e.t0;case 21:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(t){return e.apply(this,arguments)}}(),[t,o,f,r,i,n]);return a.createElement(l,{as:"form",onSubmit:u(g),css:{flex:"1",gap:4}},a.createElement(l,{css:{gap:3,overflow:"auto",flex:"1"}},a.createElement(l,{css:{gap:2}},a.createElement("label",null,n.formatMessage({id:"Password"})),a.createElement(we,Object.assign({type:"password"},d("password",{required:n.formatMessage({id:"Password is required"})}))),m.errors.password&&a.createElement(ie,null,m.errors.password.message)),a.createElement(l,{css:{gap:2}},a.createElement("label",null,n.formatMessage({id:"New email address"})),a.createElement(we,Object.assign({type:"email"},d("newEmail",{required:n.formatMessage({id:"Email address is required"})}))),m.errors.newEmail&&a.createElement(ie,null,m.errors.newEmail.message))),a.createElement(l,{css:{gap:3}},a.createElement(K,{disabled:m.isSubmitting,type:"submit"},n.formatMessage({id:"Change email address"})),a.createElement(l,{css:{alignItems:"center"}},a.createElement(de,{onClick:r},n.formatMessage({id:"Back"})))))},mr=function(e){var t=e.currentUser,r=e.onClose,n=s(),o=(0,a.useContext)(O).updateUsername,i=(0,a.useContext)(S),c=ar(),u=c.handleSubmit,d=c.register,f=c.formState,m=(0,a.useCallback)(function(){var e=p(h().mark((function e(a){var s;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=a.newUsername,e.prev=1,e.next=4,o(t,s);case 4:i(n.formatMessage({id:"Username updated successfuly"})),r(),e.next=12;break;case 8:throw e.prev=8,e.t0=e.catch(1),i(n.formatMessage({id:"An error occured, please retry later"})),e.t0;case 12:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(t){return e.apply(this,arguments)}}(),[t,o,r,i,n]);return a.createElement(l,{as:"form",onSubmit:u(m),css:{flex:"1",gap:4}},a.createElement(l,{css:{gap:3,overflow:"auto",flex:"1"}},a.createElement(l,{css:{gap:2}},a.createElement("label",null,n.formatMessage({id:"New username"})),a.createElement(we,Object.assign({type:"text"},d("newUsername",{required:n.formatMessage({id:"Username is required"})}))),f.errors.newUsername&&a.createElement(ie,null,f.errors.newUsername.message))),a.createElement(l,{css:{gap:3}},a.createElement(K,{disabled:f.isSubmitting,type:"submit"},n.formatMessage({id:"Change username"})),a.createElement(l,{css:{alignItems:"center"}},a.createElement(de,{onClick:r},n.formatMessage({id:"Back"})))))},pr=function(e){var t=e.currentUser,r=e.onClose,n=s(),o=(0,a.useContext)(O).updateUsername,i=(0,a.useContext)(S),c=ar(),u=c.handleSubmit,d=c.register,f=c.watch,m=c.setError,g=c.formState,v=f("newPassword"),b=(0,a.useCallback)(function(){var e=p(h().mark((function e(a){var s,c;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=a.password,c=a.newPassword,e.prev=1,e.next=4,o(t,s,c);case 4:i(n.formatMessage({id:"Password changed successfuly"})),r(),e.next=19;break;case 8:e.prev=8,e.t0=e.catch(1),e.t1=e.t0.code,e.next="auth/weak-password"===e.t1?13:"auth/wrong-password"===e.t1?15:17;break;case 13:return m("newPassword",{type:"weakPassword",message:n.formatMessage({id:"Password is too weak"})}),e.abrupt("break",19);case 15:return m("password",{type:"mismatch",message:n.formatMessage({id:"Incorrect password"})}),e.abrupt("break",19);case 17:return i(n.formatMessage({id:"An error occured, please retry later"})),e.abrupt("return");case 19:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(t){return e.apply(this,arguments)}}(),[t,o,r,m,i,n]);return a.createElement(l,{as:"form",onSubmit:u(b),css:{flex:"1",gap:4}},a.createElement(l,{css:{gap:3,overflow:"auto",flex:"1"}},a.createElement(l,{css:{gap:2}},a.createElement("label",null,n.formatMessage({id:"Current password"})),a.createElement(we,Object.assign({type:"password"},d("password",{required:n.formatMessage({id:"Password is required"})}))),g.errors.password&&a.createElement(ie,null,g.errors.password.message)),a.createElement(l,{css:{gap:2}},a.createElement("label",null,n.formatMessage({id:"New password"})),a.createElement(we,Object.assign({type:"password",autoComplete:"new-password"},d("newPassword",{required:n.formatMessage({id:"Password is required"})}))),g.errors.newPassword&&a.createElement(ie,null,g.errors.newPassword.message)),a.createElement(l,{css:{gap:2}},a.createElement("label",null,n.formatMessage({id:"Confirm new password"})),a.createElement(we,Object.assign({type:"password"},d("newPasswordConfirm",{required:"Password is required",validate:function(e){return e===v||n.formatMessage({id:"Passwords must match"})}}))),g.errors.newPasswordConfirm&&a.createElement(ie,null,g.errors.newPasswordConfirm.message))),a.createElement(l,{css:{gap:3}},a.createElement(K,{disabled:g.isSubmitting,type:"submit"},n.formatMessage({id:"Change password"})),a.createElement(l,{css:{alignItems:"center"}},a.createElement(de,{onClick:r},n.formatMessage({id:"Back"})))))},gr=function(e){var t=e.uid,r=e.deferred,n=s(),o=(0,a.useContext)(S),i=(0,a.useContext)(ur.LanguageContext).language,c=(0,a.useContext)(O),u=c.currentUser,d=c.usersMetadata[t],m=d.username,g=d.signupDate,v=(0,a.useState)(!1),b=v[0],y=v[1],w=(0,a.useState)(!1),x=w[0],C=w[1],k=(0,a.useState)(!1),A=k[0],I=k[1],M=(0,a.useContext)(j).approvedTangrams,T=(0,a.useContext)(L),_=T.tangramsStarredBy,R=T.tangramsCompletedBy,D=(0,a.useMemo)((function(){for(var e,r=0,n=0,a=0,o=lr(M);!(e=o()).done;){var i=e.value;if(i.uid===t)for(var s in n++,_[i.id])s!==t&&_[i.id][s]&&(r+=1);for(var c in R[i.id])c===t&&(a+=1)}return{stars:r,completed:a,created:n}}),[M,R,_,t]),P=D.stars,U=D.completed,F=D.created,V=function(){var e=p(h().mark((function e(){return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!window.confirm(n.formatMessage({id:"Are you sure you want to log out?"}))){e.next=5;break}return e.next=3,E.auth().signOut();case 3:r.reject(f.DIALOG_CLOSED_REASON),o(n.formatMessage({id:"Logged out"}));case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return a.createElement(ae,{onClose:function(){return r.reject(f.DIALOG_CLOSED_REASON)},css:{overflow:"auto",pt:4,mt:-4,gap:3}},b?a.createElement(fr,{currentUser:u,onClose:function(){return y(!1)}}):x?a.createElement(mr,{currentUser:u,onClose:function(){return C(!1)}}):A?a.createElement(pr,{currentUser:u,onClose:function(){return I(!1)}}):a.createElement(l,{css:{gap:4,mt:-4}},a.createElement(l,{css:{gap:3,alignItems:"center"}},a.createElement(ee,{uid:t,size:"badgeBig"}),a.createElement(ce,null,m),a.createElement(l,{css:{gap:2,fontSize:2,alignItems:"center"}},u&&t===u.uid&&a.createElement(oe,null,u.firebaseUser.email),a.createElement(oe,null,n.formatMessage({id:"Joined {signupDate}"},{signupDate:new Intl.DateTimeFormat(i).format(g)})),a.createElement(oe,null,n.formatMessage({id:"Completed {completed}/{total} tangrams"},{completed:U,total:M.length})),a.createElement(oe,null,n.formatMessage({id:"Created {created} tangrams"},{created:F})),a.createElement(oe,null,a.createElement(he,{id:"Earned {stars}",values:{stars:P,starIcon:function(){return a.createElement(fe,{icon:N.nae,css:{fill:"currentColor"}})}}})))),u&&u.uid===t&&a.createElement(a.Fragment,null,a.createElement(l,{css:{gap:3,alignItems:"center"}},a.createElement(de,{onClick:function(){return y(!0)}},n.formatMessage({id:"Change email address"})),a.createElement(de,{onClick:function(){return C(!0)}},n.formatMessage({id:"Change username"})),a.createElement(de,{onClick:function(){return I(!0)}},n.formatMessage({id:"Change password"}))),a.createElement(X,{onClick:V},n.formatMessage({id:"Log out"})))))},vr=["ðŸ’ª","ðŸ”¥","ðŸ˜±","ðŸ˜Ž","ðŸŽ‰","ðŸ¥‡","ðŸš€","ðŸ‘Œ","ðŸ‘","ðŸ˜µ"],hr=function(){return vr[Math.floor(Math.random()*vr.length)]},br=r(4130),yr=r.n(br),Er=function(e){var t=e.tangram,r=e.deferred,n=(0,a.useContext)(L).tangramsStarredBy,o=(0,a.useMemo)((function(){var e=0;for(var r in n[t.id])n[t.id][r]&&(e+=1);return e}),[t,n]);return a.createElement(ae,{onClose:function(){return r.reject(f.DIALOG_CLOSED_REASON)},css:{gap:3}},a.createElement(l,{css:{gap:3,overflow:"auto",flex:"1",alignItems:"center"}},a.createElement(re,{selected:!0,tangram:t}),a.createElement(oe,{css:{fontSize:2}},a.createElement(he,{id:"Earned {stars}",values:{stars:o,starIcon:function(){return a.createElement(fe,{icon:N.nae,css:{fill:"currentColor"}})}}}))))},wr=function(e){var t=e.tangram,r=e.deferred,n=s(),o=(0,a.useContext)(S),i=(0,a.useContext)(O).currentUser,c=(0,a.useState)((function(){return Object.assign({},t)})),u=c[0],d=c[1],m=(0,a.useContext)(L).tangramsStarredBy,g=i&&!t.id,v=ar({defaultValues:(0,a.useMemo)((function(){return{path:t.path,category:t.category,emoji:"digits"!==t.category&&"letters"!==t.category?t.emoji:hr(),letterIndex:"letters"===t.category?f.LETTERS.indexOf(t.emoji):void 0,digitIndex:"digits"===t.category?f.DIGITS.indexOf(t.emoji):void 0}}),[t])}),b=v.handleSubmit,y=v.register,w=v.watch,x=v.setError,C=v.clearError,k=v.formState,A=w(),I=A.path,M=A.category,T=A.emoji,j=A.letterIndex,_=A.digitIndex;(0,a.useEffect)((function(){try{var e=function(e){var t=yr().project.importSVG('<path d="'+e+'" />',{applyMatrix:!0,insert:!1}),r={path:t.exportSVG().getAttribute("d"),edges:t.curves.length,height:Math.round(t.bounds.height),width:Math.round(t.bounds.width),length:Math.round(t.length)};if(t.remove(),r.edges<3||r.edges>23)throw new Error("Invalid path");return r}(I);d((function(t){return Object.assign({},t,e)})),C("path")}catch(t){x("path",{type:"invalid",message:n.formatMessage({id:"Invalid path"})})}}),[I,x,C,n]),(0,a.useEffect)((function(){var e="letters"===M?f.LETTERS[j]:"digits"===M?f.DIGITS[_]:T||hr();d((function(t){return Object.assign({},t,{emoji:e})}))}),[M,T,j,_]),(0,a.useEffect)((function(){d((function(e){return Object.assign({},e,{category:M})}))}),[M]);var R=function(){var e=p(h().mark((function e(){return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!window.confirm(n.formatMessage({id:"Are you sure you want to delete this tangram?"}))){e.next=5;break}return e.next=3,E.firestore().collection("tangrams").doc(t.id).delete();case 3:o(n.formatMessage({id:"Tangram deleted successfuly"})),r.resolve();case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),D=function(){var e=p(h().mark((function e(){return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!g){e.next=6;break}return e.next=3,E.firestore().collection("tangrams").add(Object.assign({},u,{uid:i.uid,approved:!1}));case 3:o(n.formatMessage({id:"Tangram submitted for review"})),e.next=9;break;case 6:return e.next=8,E.firestore().collection("tangrams").doc(t.id).update(u);case 8:o(n.formatMessage({id:"Tangram modified successfuly"}));case 9:r.resolve();case 10:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),P=(0,a.useMemo)((function(){if(!t.approved)return 0;var e=0;for(var r in m[t.id])m[t.id][r]&&(e+=1);return e}),[t,m]);return a.createElement(ae,{title:a.createElement(ce,null,g?n.formatMessage({id:"Submit your tangram"}):n.formatMessage({id:"Edit your tangram"})),onClose:function(){return r.reject(f.DIALOG_CLOSED_REASON)},as:"form",onSubmit:b(D),css:{gap:3}},a.createElement(l,{css:{gap:3,overflow:"auto",flex:"1"}},a.createElement(re,{showStroke:i.isAdmin,selected:!0,completed:!0,tangram:u,css:{alignSelf:"center"}}),t.approved&&a.createElement(oe,{css:{alignSelf:"center",fontSize:2}},a.createElement(he,{id:"Earned {stars}",values:{stars:P,starIcon:function(){return a.createElement(fe,{icon:N.nae,css:{fill:"currentColor"}})}}})),g&&!i.isAdmin&&a.createElement(se,null,a.createElement(he,{id:"A moderator will have to approve your tangram. It can be deleted or edited at any time.",values:{br:function(){return a.createElement("br",null)}}})),i&&i.isAdmin&&a.createElement(a.Fragment,null,a.createElement(l,{css:{gap:2}},a.createElement("label",null,n.formatMessage({id:"Path"})),a.createElement(we,Object.assign({as:"textarea"},y("path"))),k.errors.path&&a.createElement(ie,null,k.errors.path.message))),a.createElement(l,{css:{gap:2}},a.createElement("label",null,n.formatMessage({id:"Category"})),a.createElement(we,Object.assign({as:"select"},y("category")),f.CATEGORIES.map((function(e){return a.createElement("option",{key:e,value:e},n.formatMessage({id:e}))})))),"digits"===M?a.createElement(l,{css:{gap:2}},a.createElement("label",null,n.formatMessage({id:"Victory emoji"})),a.createElement(we,Object.assign({as:"select"},y("digitIndex")),f.DIGITS.map((function(e,t){return a.createElement("option",{key:t,value:t},e)})))):"letters"===M?a.createElement(l,{css:{gap:2}},a.createElement("label",null,n.formatMessage({id:"Victory emoji"})),a.createElement(we,Object.assign({as:"select"},y("letterIndex")),f.LETTERS.map((function(e,t){return a.createElement("option",{key:t,value:t},e)})))):a.createElement(l,{css:{gap:2}},a.createElement("label",null,n.formatMessage({id:"Victory emoji"})),a.createElement(we,y("emoji")),a.createElement(se,null,n.formatMessage({id:"Leave empty for random emoji"})))),a.createElement(K,{type:"submit"},g?n.formatMessage({id:"Submit!"}):n.formatMessage({id:"Edit!"})),!g&&a.createElement(l,{css:{alignItems:"center"}},a.createElement(de,{onClick:R},n.formatMessage({id:"Or delete tangram"}))))},xr=function(e){var t=e.tangram,r=e.deferred,n=(0,a.useContext)(O).currentUser;return n&&(n.isAdmin||!t.id||t.uid===n.uid)?a.createElement(wr,{tangram:t,deferred:r}):a.createElement(Er,{tangram:t,deferred:r})},Sr=function(){var e=this;this.promise=new Promise((function(t,r){e.resolve=t,e.reject=r}))},Cr=r(399),kr=(0,a.createContext)([!0,function(){}]),Ar=function(){return(0,a.useContext)(kr)},Or=function(e){var t=e.children,r=(0,a.useState)(!0),n=r[0],o=r[1];(0,a.useEffect)((function(){var e=window.localStorage.getItem("showBackgroundPattern");if(null!==e)try{var t=JSON.parse(e);o(!!JSON.parse(t))}catch(r){window.localStorage.removeItem("showBackgroundPattern")}else o(!0)}),[]);var i=(0,a.useCallback)((function(){var e=!n;o(e),window.localStorage.setItem("showBackgroundPattern",JSON.stringify(e))}),[n]),s=(0,a.useMemo)((function(){return[n,i]}),[n,i]);return a.createElement(kr.Provider,{value:s},t)};r(7727);function Ir(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(r)return(r=r.call(e)).next.bind(r);if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return Mr(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Mr(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0;return function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function Mr(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var Tr=(0,a.createContext)(),jr=function(e){var t=e.deferred,r=e.tip,n=r.id,o=r.title,i=void 0===o?a.createElement(ce,null,a.createElement(he,{id:"Random tip"})):o,c=r.content,u=s(),d=(0,a.useState)(!1),m=d[0],p=d[1];return a.createElement(ae,{onClose:function(){return t.reject(f.DIALOG_CLOSED_REASON)},title:i,css:{gap:3,maxWidth:"300px"}},c,a.createElement(K,{onClick:function(){return t.resolve(m)}},u.formatMessage({id:"Got it!"})),"welcome"!==n&&a.createElement(l,{as:"label",css:{gap:1,flexDirection:"row",cursor:"pointer",alignItems:"flex-end"}},a.createElement("input",{type:"checkbox",checked:m,onChange:function(){return p(!m)}}),a.createElement(oe,{as:"small"},u.formatMessage({id:"I don't want to see tips anymore"}))))},_r={settingsIcon:a.createElement(fe,{icon:N.nbt}),accountIcon:a.createElement(fe,{icon:N.fzv}),menuIcon:a.createElement(fe,{icon:N.cur}),galleryIcon:a.createElement(fe,{icon:N.aCJ}),shareIcon:a.createElement(fe,{icon:N.PMT}),createIcon:a.createElement(fe,{icon:N.mW3}),leaderboardIcon:a.createElement(fe,{icon:N.HR2}),starIcon:a.createElement(fe,{icon:N.nae}),br:function(){return a.createElement("br",null)}},Rr=[{id:"particles",predicate:function(e){return e.particles},content:a.createElement(oe,{css:{textAlign:"justify"}},a.createElement(he,{id:"tips.particles",values:_r}))},{id:"menu",content:a.createElement(oe,{css:{textAlign:"justify"}},a.createElement(he,{id:"tips.menu",values:_r}))},{id:"gallery",content:a.createElement(oe,{css:{textAlign:"justify"}},a.createElement(he,{id:"tips.gallery",values:_r}))},{id:"difficulty",predicate:function(e){return e.showBackgroundPattern},content:a.createElement(oe,{css:{textAlign:"justify"}},a.createElement(he,{id:"tips.difficulty",values:_r}))},{id:"theme",predicate:function(e){return"dark"!==e.themeKey},content:a.createElement(oe,{css:{textAlign:"justify"}},a.createElement(he,{id:"tips.theme",values:_r}))},{id:"sound",predicate:function(e){return e.soundEnabled},content:a.createElement(oe,{css:{textAlign:"justify"}},a.createElement(he,{id:"tips.sound",values:_r}))},{id:"account1",predicate:function(e){return!e.currentUser},content:a.createElement(oe,{css:{textAlign:"justify"}},a.createElement(he,{id:"tips.account1",values:_r}))},{id:"account2",predicate:function(e){return!e.currentUser},content:a.createElement(oe,{css:{textAlign:"justify"}},a.createElement(he,{id:"tips.account2",values:_r}))},{id:"stars",predicate:function(e){return e.currentUser},content:a.createElement(oe,{css:{textAlign:"justify"}},a.createElement(he,{id:"tips.stars",values:_r}))},{id:"create",predicate:function(e){var t=e.currentUser,r=e.approvedTangrams,n=e.isTangramCompleted;if(t)for(var a,o=0,i=Ir(r);!(a=i()).done;){if(n(a.value.id)&&10===(o+=1))return!0}return!1},content:a.createElement(oe,{css:{textAlign:"justify"}},a.createElement(he,{id:"tips.create",values:_r}))},{id:"share",content:a.createElement(oe,{css:{textAlign:"justify"}},a.createElement(he,{id:"tips.share",values:_r}))},{id:"card",content:a.createElement(oe,{css:{textAlign:"justify"}},a.createElement(he,{id:"tips.card",values:_r}))},{id:"leaderboard",content:a.createElement(oe,{css:{textAlign:"justify"}},a.createElement(he,{id:"tips.leaderboard",values:_r}))}],Dr=function(e){var t=e.children,r=s(),n=(0,a.useContext)(S),o=(0,a.useState)(null),i=o[0],c=o[1],u=(0,a.useState)(!0),l=u[0],d=u[1],f=(0,a.useContext)(W).soundEnabled,m=(0,Cr.useSwitchTheme)()[0],p=Ar()[0],v=(0,a.useContext)(O).currentUser,h=(0,a.useContext)(j).approvedTangrams,b=(0,a.useContext)(L).isTangramCompleted;(0,a.useEffect)((function(){d(null===window.localStorage.getItem("hideTips"))}),[]),(0,a.useEffect)((function(){l?window.localStorage.removeItem("hideTips"):window.localStorage.setItem("hideTips",!0)}),[l]);var y=function(){var e=[],t=localStorage.getItem("seenTips");if(t)try{var r=JSON.parse(t);if(!Array.isArray(r))throw new Error("Invalid data for seenTips : "+r);e=r}catch(n){localStorage.removeItem("seenTips")}return e},E=(0,a.useCallback)((function(e){var t=y(),r=new Sr;return c({deferred:r,tip:e}),r.promise.then((function(e){e&&d(!1)})).finally((function(){localStorage.setItem("seenTips",JSON.stringify([].concat((0,g.Z)(t),[e.id]))),c(null)}))}),[]),w=(0,a.useCallback)((function(){l&&(y().includes("welcome")||v&&h.some((function(e){return b(e.id)}))||E({id:"welcome",title:a.createElement(ce,null,a.createElement(he,{id:"Welcome to Amstangram",values:_r})),content:a.createElement(oe,{css:{textAlign:"justify"}},a.createElement(he,{id:"tips.welcome",values:_r}))}))}),[E,l,v,h,b]),x=(0,a.useCallback)((function(){if(l){var e=y(),t=Rr.filter((function(t){var r=t.id,n=t.predicate,a=void 0===n?function(){return!0}:n;return!e.includes(r)&&a({themeKey:m,showBackgroundPattern:p,currentUser:v,approvedTangrams:h,isTangramCompleted:b,soundEnabled:f})}));if(t.length){var r=t[0];E(r)}}}),[E,h,b,m,v,p,f,l]),C=(0,a.useCallback)((function(){d((function(e){return!e}))}),[]),k=(0,a.useCallback)((function(){d(!0),window.localStorage.removeItem("seenTips"),n(r.formatMessage({id:"Tips reseted successfuly"}))}),[n,r]),A=(0,a.useMemo)((function(){return{showRandomTip:x,showWelcome:w,tipsEnabled:l,toggleTips:C,resetTips:k}}),[x,w,l,C,k]);return a.createElement(Tr.Provider,{value:A},t,i&&a.createElement(jr,i))},Lr=function(e){var t=e.leftComponent,r=e.leftValue,o=e.rightComponent,i=e.rightValue,s=e.value,c=e.onChange,u=e.invertSounds,d=(0,a.useContext)(W),f=d.playToggle,m=d.soundEnabled,p=(0,a.useContext)(n.ThemeContext),g=(0,a.useMemo)((function(){return s===i?"right":"left"}),[s,i]),v=function(){u?m||f({forceSoundEnabled:!0}):f()},h=function(e){e!==g&&(c("right"===e?i:r),v())};return a.createElement(l,{css:{flexDirection:"row",justifyContent:"center",alignItems:"center",gap:3}},a.createElement(l,{css:{cursor:"pointer",flex:"1",alignItems:"flex-end"},onClick:function(){return h("left")}},t),a.createElement(l,{onClick:function(){c("right"===("left"===g?"right":"left")?i:r),v()},css:{cursor:"pointer",position:"relative",bg:"inputBackground",width:"40px",height:"20px",borderRadius:"99999px"}},a.createElement(l,{css:{position:"absolute",size:"20px",borderRadius:"99999px",bg:"dialogText",boxShadow:"0 0 0 2px "+p.colors.inputBackground,transition:"left 250ms ease-in-out"},style:{left:"left"===g?0:20}})),a.createElement(l,{css:{cursor:"pointer",flex:"1",alignItems:"flex-start"},onClick:function(){return h("right")}},o))},Pr=(0,a.createContext)([!0,function(){}]),Nr=function(){return(0,a.useContext)(Pr)},Ur=function(e){var t=e.children,r=(0,a.useState)(!0),n=r[0],o=r[1];(0,a.useEffect)((function(){var e=window.localStorage.getItem("showParticles");if(null!==e)try{var t=JSON.parse(e);o(!!JSON.parse(t))}catch(r){window.localStorage.removeItem("showParticles")}else o(!0)}),[]);var i=(0,a.useCallback)((function(){var e=!n;o(e),window.localStorage.setItem("showParticles",JSON.stringify(e))}),[n]),s=(0,a.useMemo)((function(){return[n,i]}),[n,i]);return a.createElement(Pr.Provider,{value:s},t)},Fr=function(e){var t=e.deferred,r=(0,a.useContext)(W),n=r.soundEnabled,o=r.toggleSound,i=(0,a.useContext)(Tr),c=i.tipsEnabled,u=i.toggleTips,d=i.resetTips,m=Ar(),p=m[0],g=m[1],v=Nr(),h=v[0],b=v[1],y=(0,a.useContext)(ur.LanguageContext),E=y.language,w=y.setLanguage,x=s(),S=(0,Cr.useSwitchTheme)(),C=S[0],k=S[1];return a.createElement(ae,{title:a.createElement(ce,null,x.formatMessage({id:"Settings"})),onClose:function(){return t.reject(f.DIALOG_CLOSED_REASON)},css:{gap:4}},a.createElement(l,{css:{gap:3}},a.createElement(l,{css:{gap:2}},a.createElement("label",null,x.formatMessage({id:"Language"})),a.createElement(we,{as:"select",onChange:function(e){w(e.target.value)},value:E},ur.supportedLanguages.map((function(e){return a.createElement("option",{key:e,value:e},x.formatMessage({id:e}))})))),a.createElement(l,{css:{gap:2}},a.createElement("label",null,x.formatMessage({id:"Difficulty"})),a.createElement(Lr,{value:p,onChange:g,leftComponent:a.createElement(oe,null,x.formatMessage({id:"Easy"})),leftValue:!0,rightComponent:a.createElement(oe,null,x.formatMessage({id:"Hard"})),rightValue:!1})),a.createElement(l,{css:{gap:2}},a.createElement("label",null,x.formatMessage({id:"Theme"})),a.createElement(Lr,{value:C,onChange:k,leftComponent:a.createElement(l,{as:N.kXG,css:{size:"icon"}}),leftValue:"light",rightComponent:a.createElement(l,{as:N.wOW,css:{size:"icon"}}),rightValue:"dark"})),a.createElement(l,{css:{gap:2}},a.createElement("label",null,x.formatMessage({id:"Sounds"})),a.createElement(Lr,{invertSounds:!0,value:n,onChange:o,leftComponent:a.createElement(l,{as:N.LIZ,css:{size:"icon"}}),leftValue:!1,rightComponent:a.createElement(l,{as:N.l3f,css:{size:"icon"}}),rightValue:!0})),a.createElement(l,{css:{gap:2}},a.createElement("label",null,x.formatMessage({id:"Show tips"})),a.createElement(Lr,{value:c,onChange:u,leftComponent:a.createElement(oe,null,x.formatMessage({id:"Yes"})),leftValue:!0,rightComponent:a.createElement(oe,null,x.formatMessage({id:"No"})),rightValue:!1})),a.createElement(l,{css:{gap:2}},a.createElement("label",null,x.formatMessage({id:"Show particles"})),a.createElement(Lr,{value:h,onChange:b,leftComponent:a.createElement(oe,null,x.formatMessage({id:"Yes"})),leftValue:!0,rightComponent:a.createElement(oe,null,x.formatMessage({id:"No"})),rightValue:!1}))),a.createElement(J,{onClick:d},x.formatMessage({id:"Reset tips"})))},Vr=(0,a.createContext)(),zr=function(e){var t=e.children,r=(0,a.useContext)(O).initialized,n=(0,a.useContext)(L),o=n.playlist,i=n.startRandomPlaylist,s=n.initialized,c=(0,a.useContext)(j),u=c.initialized,l=c.approvedTangrams,d=(0,a.useState)(!1),m=d[0],g=d[1],v=(0,a.useState)(null),b=v[0],y=v[1],E=(0,a.useCallback)(function(){var e=p(h().mark((function e(t){var r;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=new Sr,y({uid:t,deferred:r}),e.prev=2,e.next=5,r.promise;case 5:e.next=11;break;case 7:if(e.prev=7,e.t0=e.catch(2),e.t0===f.DIALOG_CLOSED_REASON){e.next=11;break}throw e.t0;case 11:return e.prev=11,y(null),e.finish(11);case 14:case"end":return e.stop()}}),e,null,[[2,7,11,14]])})));return function(t){return e.apply(this,arguments)}}(),[]),w=(0,a.useState)(null),x=w[0],S=w[1],C=(0,a.useCallback)(p(h().mark((function e(){var t;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=new Sr,S(t),e.prev=2,e.next=5,t.promise;case 5:e.next=11;break;case 7:if(e.prev=7,e.t0=e.catch(2),e.t0===f.DIALOG_CLOSED_REASON){e.next=11;break}throw e.t0;case 11:return e.prev=11,S(null),e.finish(11);case 14:case"end":return e.stop()}}),e,null,[[2,7,11,14]])}))),[]),k=(0,a.useState)(null),A=k[0],I=k[1],M=(0,a.useCallback)(p(h().mark((function e(){var t;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=new Sr,I(t),e.prev=2,e.next=5,t.promise;case 5:e.next=11;break;case 7:if(e.prev=7,e.t0=e.catch(2),e.t0===f.DIALOG_CLOSED_REASON){e.next=11;break}throw e.t0;case 11:return e.prev=11,I(null),e.finish(11);case 14:case"end":return e.stop()}}),e,null,[[2,7,11,14]])}))),[]),T=(0,a.useState)(null),_=T[0],R=T[1],D=(0,a.useCallback)(p(h().mark((function e(){var t;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=new Sr,R(t),e.prev=2,e.next=5,t.promise;case 5:e.next=11;break;case 7:if(e.prev=7,e.t0=e.catch(2),e.t0===f.DIALOG_CLOSED_REASON){e.next=11;break}throw e.t0;case 11:return e.prev=11,R(null),e.finish(11);case 14:case"end":return e.stop()}}),e,null,[[2,7,11,14]])}))),[]),P=(0,a.useState)(null),N=P[0],U=P[1],F=(0,a.useCallback)(function(){var e=p(h().mark((function e(t){var r;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=new Sr,U({deferred:r,tangram:t}),e.prev=2,e.next=5,r.promise;case 5:e.next=11;break;case 7:if(e.prev=7,e.t0=e.catch(2),e.t0===f.DIALOG_CLOSED_REASON){e.next=11;break}throw e.t0;case 11:return e.prev=11,U(null),e.finish(11);case 14:case"end":return e.stop()}}),e,null,[[2,7,11,14]])})));return function(t){return e.apply(this,arguments)}}(),[]),V=(0,a.useState)(null),z=V[0],B=V[1],G=(0,a.useCallback)(p(h().mark((function e(){var t;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=new Sr,B(t),e.prev=2,e.next=5,t.promise;case 5:e.next=11;break;case 7:if(e.prev=7,e.t0=e.catch(2),e.t0===f.DIALOG_CLOSED_REASON){e.next=11;break}throw e.t0;case 11:return e.prev=11,B(null),e.finish(11);case 14:case"end":return e.stop()}}),e,null,[[2,7,11,14]])}))),[]),q=(0,a.useState)(null),W=q[0],Y=q[1];(0,a.useEffect)((function(){var e=function(){var e=p(h().mark((function e(){var t,n,a,c,d,p;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(u&&s&&r)||m){e.next=28;break}if(t=!1,o||!window.location.search){e.next=26;break}if(!(n=new URLSearchParams(window.location.search)).has("tangrams")){e.next=26;break}if(a=n.get("tangrams").split(","),c=n.get("uid"),!(d=l.filter((function(e){return a.includes(e.id)}))).length){e.next=26;break}return t=!0,window.history.replaceState({},document.title,window.location.origin),p=new Sr,Y({deferred:p,tangrams:d,uid:c}),e.prev=13,e.next=16,p.promise;case 16:i(!0),e.next=23;break;case 19:if(e.prev=19,e.t0=e.catch(13),e.t0===f.DIALOG_CLOSED_REASON){e.next=23;break}throw e.t0;case 23:return e.prev=23,Y(null),e.finish(23);case 26:t||i(!0),g(!0);case 28:case"end":return e.stop()}}),e,null,[[13,19,23,26]])})));return function(){return e.apply(this,arguments)}}();e()}),[u,s,r,m]);var H=(0,a.useMemo)((function(){return{showProfile:E,showLeaderboard:C,showGallery:M,showLogin:D,showTangram:F,showSettings:G}}),[E,C,M,D,F,G]);return a.createElement(Vr.Provider,{value:H},t,_&&a.createElement(cr,{deferred:_}),A&&a.createElement(Ae,{deferred:A}),N&&a.createElement(xr,N),b&&a.createElement(gr,b),x&&a.createElement(Te,{deferred:x}),W&&a.createElement(me,W),z&&a.createElement(Fr,{deferred:z}))},Br=function(e){var t=e.action,r=e.icon,n=e.text,o=(0,a.useContext)(W).playButton;return a.createElement(l,{css:{alignItems:"center",flexDirection:"row",gap:3,cursor:"pointer",py:3},onClick:function(){o(),t()}},a.createElement(l,{as:r,css:{size:"icon"}}),a.createElement(oe,{css:{fontSize:3}},n))},Gr=function(){var e=(0,a.useContext)(L),t=e.playlist,r=e.saveRequestId,o=(0,a.useContext)(O).currentUser,i=(0,a.useContext)(W).playButton,c=s(),u=(0,a.useContext)(Vr),m=u.showLeaderboard,g=u.showGallery,v=u.showLogin,b=u.showProfile,y=u.showSettings,E=(0,a.useState)(),w=E[0],x=E[1];(0,a.useEffect)((function(){w&&w.reject(f.DIALOG_CLOSED_REASON)}),[t,r]);var S=(0,a.useContext)(L).requestSave,C=function(){var e=p(h().mark((function e(){var t;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i(),t=new Sr,x(t),e.prev=3,e.next=6,t.promise;case 6:e.next=12;break;case 8:if(e.prev=8,e.t0=e.catch(3),e.t0===f.DIALOG_CLOSED_REASON){e.next=12;break}throw e.t0;case 12:return e.prev=12,x(null),e.finish(12);case 15:case"end":return e.stop()}}),e,null,[[3,8,12,15]])})));return function(){return e.apply(this,arguments)}}(),k=(0,n.useKeyframes)({0:{color:"pieces.lt2"},14:{color:"pieces.rh"},28:{color:"pieces.st2"},42:{color:"pieces.mt1"},57:{color:"pieces.st1"},71:{color:"pieces.lt1"},85:{color:"pieces.sq"},100:{color:"pieces.lt2"}}),A=(0,n.useKeyframes)({from:{transform:"translate(0, 0)"},to:{transform:"translate(30px, -30px)"}});return a.createElement(a.Fragment,null,a.createElement(l,{css:{position:"fixed",top:3,left:3,animation:k+" 20s linear infinite both"}},a.createElement(l,{as:N.cur,css:{size:"menu",cursor:"pointer"},onClick:C})),w&&a.createElement(ae,{onClose:function(){return w.reject(f.DIALOG_CLOSED_REASON)},title:a.createElement(l,{css:{flexDirection:"row",gap:3,alignItems:"center"}},a.createElement(d,{css:{size:"badge",ml:"-2px",mr:"-6px",overflow:"visible","& > g":{animation:A+" "+f.FADE_TRANSITION_DURATION+"ms "+f.FADE_STAGGER_DURATION+"ms ease both"}}}),a.createElement(ce,null,c.formatMessage({id:"Amstangram"}))),css:{gap:3,overflow:"initial"}},a.createElement(l,null,o?a.createElement(Br,{action:function(){return b(o.uid)},icon:function(){return a.createElement(ee,{css:{mx:-1},uid:o.uid,size:"badge"})},text:c.formatMessage({id:"See my profile"})}):a.createElement(Br,{action:v,icon:N.fzv,text:c.formatMessage({id:"Log in"})}),a.createElement(Br,{action:g,icon:N.aCJ,text:c.formatMessage({id:"Tangram gallery"})}),a.createElement(Br,{action:S,icon:N.mW3,text:c.formatMessage({id:"Save tangram"})}),a.createElement(Br,{action:m,icon:N.HR2,text:c.formatMessage({id:"Leaderboard"})}),a.createElement(Br,{action:y,icon:N.nbt,text:c.formatMessage({id:"Settings"})})),a.createElement(l,{css:{flexDirection:"row",alignItems:"baseline",justifyContent:"space-between"}},a.createElement(se,{as:le,href:"mailto:millagou.benjamin@gmail.com?subject="+c.formatMessage({id:"A word about Amstangram"}),target:"_blank",rel:"noopener, noreferrer"},c.formatMessage({id:"Contact ðŸ’Œ"})),a.createElement(se,{as:le,href:"https://github.com/myagoo/amstangram",target:"_blank",rel:"noopener, noreferrer"},c.formatMessage({id:"Version {code}"},{code:"â­.ðŸ§ .ðŸ–¼"})))))},qr=function(e,t){var r=new window.ClipperLib.ClipperOffset,n=new window.ClipperLib.Paths;if(r.AddPaths([e.map((function(e){return{X:e.x,Y:e.y}}))],window.ClipperLib.JoinType.jtMiter,window.ClipperLib.EndType.etClosedPolygon),r.MiterLimit=0,r.ArcTolerance=0,r.Execute(n,t),n.length)return n[0].map((function(e){var t=e.X,r=e.Y;return new(yr().Point)(t,r)}))},Wr=function(e,t){var r=[new(yr().Point)(0,0),new(yr().Point)(2*e,0),new(yr().Point)(e,e)],n=new(yr().Path)({name:"display",segments:r,closed:!0}),a=new(yr().Path)({name:"collision",segments:qr(r,-f.COLLISION_MARGIN),closed:!0}),o=new(yr().Path)({name:"insetBorder",segments:qr(r,-f.INSET_BORDER),closed:!0,strokeWidth:f.INSET_BORDER}),i=function(e){var t=e[1].getDistance(e[2]),r=e[0].getDistance(e[2]),n=e[0].getDistance(e[1]),a=t+r+n,o=(e[0].x*t+e[1].x*r+e[2].x*n)/a,i=(e[0].y*t+e[1].y*r+e[2].y*n)/a;return new(yr().Point)(o,i)}(r),s=new(yr().Point)(yr().view.center.x+i.x-n.bounds.width/2,yr().view.center.y+i.y-n.bounds.height/2);return new(yr().Group)({children:[n,a,o],position:yr().view.center,pivot:s,data:{id:t,collisions:new Set},applyMatrix:!0})},Yr=function(e,t){var r=[new(yr().Point)(0,0),new(yr().Point)(2*e,0),new(yr().Point)(3*e,e),new(yr().Point)(e,e)],n=new(yr().Path)({name:"display",segments:r,closed:!0}),a=new(yr().Path)({name:"collision",segments:qr(r,-f.COLLISION_MARGIN),closed:!0,strokeWidth:f.COLLISION_MARGIN}),o=new(yr().Path)({name:"insetBorder",segments:qr(r,-f.INSET_BORDER),closed:!0,strokeWidth:f.INSET_BORDER});return new(yr().Group)({children:[n,a,o],position:yr().view.center,data:{id:t,collisions:new Set},applyMatrix:!0})};function Hr(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(r)return(r=r.call(e)).next.bind(r);if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return $r(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return $r(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0;return function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function $r(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var Zr=function(e,t,r){var n=r.x-t.x,a=r.y-t.y,o=n*n+a*a,i=(e.x-t.x)*n+(e.y-t.y)*a,s=Math.min(1,Math.max(0,i/o));return i=(r.x-t.x)*(e.y-t.y)-(r.y-t.y)*(e.x-t.x),new(yr().Point)(t.x+n*s,t.y+a*s)};function Jr(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(r)return(r=r.call(e)).next.bind(r);if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return Xr(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Xr(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0;return function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function Xr(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var Kr=function(e,t,r){for(var n,a=Jr(t);!(n=a()).done;)for(var o,i=n.value,s=Jr(i.segments);!(o=s()).done;)for(var c,u=o.value.point,l=Jr(e.segments);!(c=l()).done;){var d=c.value.point,f=d.getDistance(u);f<r.distance&&(r.distance=f,r.shape=i,r.vector=u.subtract(d))}if(!r.vector)for(var m,p=Jr(t);!(m=p()).done;){for(var g,v=m.value,h=Jr(e.segments);!(g=h()).done;)for(var b,y=g.value.point,E=Jr(v.segments);!(b=E()).done;){var w=b.value,x=w.point,S=w.next.point,C=Zr(y,x,S),k=C.getDistance(y);k<r.distance&&(r.distance=k,r.vector=C.subtract(y),r.shape=v,r.segment=[x,S],r.point=y)}for(var A,O=Jr(v.segments);!(A=O()).done;)for(var I,M=A.value.point,T=Jr(e.segments);!(I=T()).done;){var j=I.value,_=j.point,R=j.next.point,D=Zr(M,_,R),L=D.getDistance(M);L<r.distance&&(r.distance=L,r.vector=M.subtract(D),r.shape=e,r.segment=[_,R])}}return r},Qr=function(e,t,r){if(r.segment){for(var n,a=r.maxDistance,o=r.segment,i=o[0],s=o[1],c=0,u=[Math.atan2(s.y-i.y,s.x-i.x),Math.atan2(i.y-s.y,i.x-s.x)];c<u.length;c++)for(var l,d=u[c],f=Jr(e.segments);!(l=f()).done;){var m=l.value.point;if(m!==r.point)for(var p,g=m.add(r.vector),v=new(yr().Point)(g.x+r.maxDistance*Math.cos(d),g.y+r.maxDistance*Math.sin(d)),h=new(yr().Path.Line)({from:g,to:v,insert:!1}),b=Jr(t);!(p=b()).done;)for(var y,E=p.value,w=Jr(h.getIntersections(E));!(y=w()).done;){var x=y.value.point.subtract(g).add(r.vector);x.length<r.maxDistance&&x.length<=a&&(a=x.length,n=x)}}n&&(r.vector=n)}};function en(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(r)return(r=r.call(e)).next.bind(r);if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return tn(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return tn(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0;return function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function tn(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function rn(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(r)return(r=r.call(e)).next.bind(r);if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return nn(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return nn(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0;return function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function nn(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var an=function(e,t){var r=e.pivot?e.pivot.subtract(e.bounds.center):new(yr().Point);e.bounds.x<0&&(e.position.x=e.bounds.width/2+r.x),e.bounds.y<0&&(e.position.y=e.bounds.height/2+r.y),e.bounds.x+e.bounds.width>t.width/window.devicePixelRatio&&(e.position.x=t.width/window.devicePixelRatio-e.bounds.width/2+r.x),e.bounds.y+e.bounds.height>t.height/window.devicePixelRatio&&(e.position.y=t.height/window.devicePixelRatio-e.bounds.height/2+r.y)},on=function(e,t){var r=new(yr().Point)(yr().project.view.bounds.width,yr().project.view.bounds.height).subtract(2*f.SCRAMBLE_PADDING);if(e.position=yr().Point.random().multiply(r).add(f.SCRAMBLE_PADDING),"rh"===e.data.id){var n=45*Math.round(3*Math.random());e.rotation=n,e.data.rotation=n}else e.rotation=45*Math.round(7*Math.random())},sn=function(e,t){return t.segments.every((function(t){return e.contains(t.point)}))};function cn(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(r)return(r=r.call(e)).next.bind(r);if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return un(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return un(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0;return function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function un(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var ln=function(e,t){for(var r,n=cn(t.children);!(r=n()).done;){var a=r.value;if(a!==e){var o=e.children.collision,i=a.children.collision;o.intersects(i)||sn(o,i)||sn(i,o)?(e.data.collisions.add(a.data.id),a.data.collisions.add(e.data.id)):(e.data.collisions.delete(a.data.id),a.data.collisions.delete(e.data.id))}}for(var s,c=!0,u=cn(t.children);!(s=u()).done;){var l=s.value;l.data.collisions.size>0?(c=!1,l.children.display.opacity=f.OVERLAPING_OPACITY):l.children.display.opacity=1}return c},dn=function(e){var t=e.tangram,r=e.onStop,o=e.onNext,i=e.onApprove,c=e.onStarToggle,u=s(),d=(0,a.useState)(!1),m=d[0],p=d[1],g=(0,a.useContext)(W).playStar,v=(0,a.useContext)(L),h=v.tangramsStarredBy,b=v.isTangramStarred,y=(0,a.useMemo)((function(){var e=0;for(var r in h[t.id])h[t.id][r]&&(e+=1);return e}),[t,h]),E=b(t.id),w=(0,n.useKeyframes)({0:{opacity:"0",transform:"rotate(0) scale(0)"},100:{opacity:1,transform:"rotate(1800deg) scale(1)"}});return a.createElement(l,{css:{position:"absolute",top:0,left:0,right:0,bottom:0,alignItems:"center",justifyContent:"center",gap:3}},a.createElement(l,{css:{position:"relative"}},a.createElement(l,{key:"emojiSpin",onAnimationEnd:function(){setTimeout((function(){return p(!0)}),1e3)},css:{textShadow:"0px 5px 10px #00000080",fontSize:"30vmin",animation:"2000ms "+w+" cubic-bezier(.6,1.56,.58,.92) forwards"}},t.emoji),m&&a.createElement(l,{css:{mt:3,position:"absolute",top:"100%",left:"50%",transform:"translateX(-50%)",flexDirection:"row",gap:3,animation:f.FADE_TRANSITION_DURATION+"ms fadeIn ease both"}},i&&a.createElement(l,{as:K,onClick:i,css:{boxShadow:"0px 5px 10px #00000080",flexDirection:"row",gap:2,alignItems:"flex-end"}},a.createElement(l,{as:N.UgA,css:{size:"icon"}}),a.createElement(oe,null,u.formatMessage({id:"Approve"}))),c&&a.createElement(l,{as:K,mute:!0,onClick:function(){g(),c()},css:{boxShadow:"0px 5px 10px #00000080",flexDirection:"row",gap:2,alignItems:"flex-end"}},a.createElement(oe,null,y),a.createElement(l,{as:N.nae,css:{size:"icon",fill:E?"currentColor":void 0},deps:[E]})),o?a.createElement(l,{as:K,onClick:o,css:{boxShadow:"0px 5px 10px #00000080",flexDirection:"row",gap:2,alignItems:"flex-end"}},a.createElement(l,{as:N.KCr,css:{size:"icon"}}),a.createElement(oe,null,u.formatMessage({id:"Next"}))):a.createElement(l,{as:K,onClick:r,css:{boxShadow:"0px 5px 10px #00000080",flexDirection:"row",gap:2,alignItems:"flex-end"}},a.createElement(l,{as:N.q5L,css:{size:"icon"}}),a.createElement(oe,null,u.formatMessage({id:"Quit"}))))))};function fn(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(r)return(r=r.call(e)).next.bind(r);if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return mn(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return mn(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0;return function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function mn(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var pn=function(){var e=s(),t=(0,a.useContext)(Tr),r=t.showRandomTip,o=t.showWelcome,i=(0,a.useContext)(Vr),c=i.showLogin,u=i.showTangram,d=(0,a.useContext)(W),m=d.playTangram,g=d.playVictory,v=(0,a.useRef)();v.current={tangram:m,victory:g};var b=(0,a.useContext)(O).currentUser;(0,a.useRef)().current=b;var y=(0,a.useContext)(n.ThemeContext),w=(0,a.useContext)(S),x=Ar()[0],C=Nr()[0],k=(0,a.useContext)(L),A=k.saveRequestId,I=k.playlist,M=k.setPlaylist,T=k.markTangramAsComplete,j=k.toggleTangramStar,_=(0,a.useRef)();_.current=T;var R=(0,a.useState)(0),D=R[0],P=R[1],N=(0,a.useState)(!1),U=N[0],F=N[1],V=(0,a.useRef)(),z=(0,a.useRef)(),B=(0,a.useRef)(),G=(0,a.useRef)(),q=(0,a.useRef)(),Y=(0,a.useRef)(),H=(0,a.useRef)(),$=(0,a.useMemo)((function(){return I&&I[D]}),[I,D]),Z=function(){var t=p(h().mark((function t(){return h().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,E.firestore().collection("tangrams").doc($.id).update({approved:!0});case 2:w(e.formatMessage({id:"Tangram approved"}));case 3:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();return(0,a.useEffect)((function(){P(0)}),[I]),(0,a.useEffect)((function(){if(A){if(!function(e){for(var t,r=rn(e.children);!(t=r()).done;)if(t.value.data.collisions.size>0)return!1;return!0}(B.current))return void w(e.formatMessage({id:"You can't save an invalid tangram"}));var t=function(e,t){for(var r,n,a=Hr(e.children);!(n=a()).done;){var o=n.value.children.display;r=r?r.unite(o,{insert:!1}):o}r.scale(1/t),r.position=new(yr().Point)(r.bounds.width/2,r.bounds.height/2);var i=r.exportSVG().getAttribute("d"),s=r.curves.length,c=Math.round(r.bounds.width),u=Math.round(r.bounds.height),l=Math.round(r.length);return r.remove(),{width:c,height:u,length:l,path:i,edges:s}}(B.current,z.current);if(23===t.edges)return void w(e.formatMessage({id:"You can't save such an easy tangram"}));var r=function(){var e=p(h().mark((function e(){return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(b){e.next=3;break}return e.next=3,c();case 3:return e.next=5,u(t);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();r()}}),[A]),(0,a.useEffect)((function(){var e=function(){if(V.current&&B.current)for(var e,t=fn(B.current.children);!(e=t()).done;){var r=e.value;an(r,V.current)}};return window.addEventListener("resize",e),function(){return window.removeEventListener("resize",e)}}),[]),(0,a.useLayoutEffect)((function(){var e=Date.now(),t=function(t){var r=null,n=null,a=null,o=null,i=function(e){document.activeElement===V.current&&(document.body.style.cursor="pointer")},s=function(e){document.body.style.cursor="default"},c=function(e){a=Date.now(),o=e.point,r=e.point.subtract(t.position),n=t.clone({insert:!1,deep:!0}),t.bringToFront()},u=function(e){document.body.style.cursor="move";var a=e.point.subtract(t.position).subtract(r);n.position=t.position.add(a);var o,i,s,c,u,l=n.children["display 1"],d=B.current.children.filter((function(e){return e!==t})).map((function(e){return e.children.display})),m=Y.current&&q.current?q.current.children?q.current.children:[q.current]:null,p=(o=f.SNAP_DISTANCE,c=m,Kr(i=l,s=d,u={maxDistance:o,distance:o}),c&&Kr(i,c,u),Qr(i,s.filter((function(e){return e.shape!==u.shape})),u),c&&Qr(i,c,u),u.vector);p&&(n.position.x+=p.x,n.position.y+=p.y),an(n,V.current),t.position=n.position,ln(t,B.current)},l=function(i){if(document.body.style.cursor="pointer",i.point.subtract(o).length<f.SNAP_DISTANCE&&Date.now()-a<f.CLICK_TIMEOUT&&(t.rotation+=45,"rh"===t.data.id&&(t.data.rotation+=45,180===t.data.rotation&&(t.data.rotation=0,t.scale(-1,1))),v.current.tangram(),an(t,V.current),ln(t,B.current),a=null,o=null),r=null,n&&n.remove(),n=null,q.current&&(!1===Y.current&&(q.current.position=B.current.position),function(e,t,r){for(var n,a=e,o=en(t.children);!(n=o()).done;){var i=n.value;if(i.data.collisions.size>0)return;a=a.unite(new(yr().Path)({segments:qr(i.children.display.segments.map((function(e){return e.point})),-r),closed:!0,insert:!1}),{insert:!1})}return Math.round(1e3*a.length)===Math.round(1e3*e.length)}(q.current,B.current,Y.current?f.STRICT_ERROR_MARGIN:f.SOFT_ERROR_MARGIN))){_.current($,Date.now()-e);for(var s,c=fn(B.current.children);!(s=c()).done;){s.value.data.removeListeners()}if(document.body.style.cursor="default",!H.current)return v.current.victory(),void F(!0);yr().project.activeLayer.tween({opacity:0},{duration:f.VICTORY_PARTICLES_DURATION,easing:"easeInCubic"});for(var u,l=fn(G.current);!(u=l()).done;){var d=u.value;d.data.animation.stop(),d.tween({"position.x":B.current.position.x,"position.y":B.current.position.y,opacity:f.MAX_PARTICLE_OPACITY},{duration:f.VICTORY_PARTICLES_DURATION,easing:"easeInCubic"})}setTimeout((function(){v.current.victory(),yr().project.activeLayer.tween({opacity:1},{duration:f.FADE_TRANSITION_DURATION,easing:"easeOutCubic"});for(var e,t=Math.max(yr().view.bounds.width,yr().view.bounds.height)/2,r=fn(G.current);!(e=r()).done;){var n=e.value;n.data.animation.stop();var a=Math.random()*Math.PI*2,o=Math.random()*t;n.tween({"position.x":n.position.x+o*Math.cos(a),"position.y":n.position.y+o*Math.sin(a),opacity:0},{duration:f.VICTORY_PARTICLES_DURATION,easing:"easeOutCubic"})}F(!0)}),f.VICTORY_PARTICLES_DURATION)}};t.on({mouseenter:i,mouseleave:s,mousedown:c,mousedrag:u,mouseup:l}),t.data.removeListeners=function(){return t.off({mouseenter:i,mouseleave:s,mousedown:c,mousedrag:u,mouseup:l})}};return function(){var e,r,n,a,o,i,s,c;yr().setup(V.current),B.current=(i=f.SMALL_TRIANGLE_BASE,s=Math.sqrt(2*Math.pow(i,2)),c=Math.sqrt(2*Math.pow(s,2)),new(yr().Group)([Wr(i,"st1"),Wr(i,"st2"),Wr(s,"mt1"),Wr(c,"lt1"),Wr(c,"lt2"),(e=s,r="sq",n=new(yr().Path.Rectangle)({name:"display",point:[0,0],size:[e,e]}),a=new(yr().Path.Rectangle)({name:"collision",point:[f.COLLISION_MARGIN,f.COLLISION_MARGIN],size:[e-2*f.COLLISION_MARGIN,e-2*f.COLLISION_MARGIN]}),o=new(yr().Path.Rectangle)({name:"insetBorder",point:[f.INSET_BORDER,f.INSET_BORDER],size:[e-2*f.INSET_BORDER,e-2*f.INSET_BORDER],strokeWidth:f.INSET_BORDER}),new(yr().Group)({children:[n,a,o],position:yr().view.center,data:{id:r,collisions:new Set},applyMatrix:!0,rotation:45*Math.round(7*Math.random())})),Yr(i,"rh")])),$&&(q.current=yr().project.importSVG('<path d="'+$.path+'" />',{applyMatrix:!0}),q.current.sendToBack(),q.current.fillRule="evenodd",q.current.closed=!0);var u=yr().project.view.bounds,l=q.current?q.current.bounds:B.current.children[3].bounds.scale(2);u.width>u.height?z.current=Math.min(2,Math.min(.6*u.width,700)/l.width,Math.min(.8*u.height,600)/l.height):z.current=Math.min(2,Math.min(.8*u.width,600)/l.width,Math.min(.6*u.height,700)/l.height),q.current&&(q.current.scale(z.current),q.current.position=yr().view.center);for(var d,m=fn(B.current.children);!(d=m()).done;){var p=d.value;p.scale(z.current),on(p,V.current),t(p),an(p,V.current),ln(p,B.current)}}(),function(){yr().project.remove(),G.current=null,B.current=null,q.current=null}}),[$]),(0,a.useLayoutEffect)((function(){Y.current=x,q.current&&(x?(q.current.fillColor=y.colors.shape,q.current.position=yr().view.center):q.current.fillColor="transparent")}),[$,x,y]),(0,a.useLayoutEffect)((function(){if(H.current=C,C){var e=new(yr().Group);e.sendToBack();var t=new(yr().Point)(V.current.width,V.current.height).divide(window.devicePixelRatio),r=function(){return Math.random()*(f.MAX_PARTICLE_SIZE-f.MIN_PARTICLE_SIZE)+f.MIN_PARTICLE_SIZE},n=function(){return Math.random()*(f.MAX_PARTICLE_OPACITY-f.MIN_PARTICLE_OPACITY)+f.MIN_PARTICLE_OPACITY};G.current=new Array(f.PARTICLES_COUNT);for(var a=function(a){var o=new(yr().Path.Circle)({center:yr().Point.random().multiply(t),radius:r(),opacity:n(),parent:e,data:{index:a}});!function e(){var t={radius:r(),opacity:n(),"position.x":Math.min(V.current.width/window.devicePixelRatio,Math.max(0,o.position.x+200*Math.random()-100)),"position.y":Math.min(V.current.height/window.devicePixelRatio,Math.max(0,o.position.y+200*Math.random()-100))};o.data.animation=o.tween(t,{duration:1e4*Math.random()+5e3,easing:"easeInOutQuad"}).then(e)}(),G.current[a]=o},o=0;o<f.PARTICLES_COUNT;o++)a(o);return function(){e.remove(),G.current=null}}}),[$,C]),(0,a.useLayoutEffect)((function(){for(var e,t=fn(B.current.children);!(e=t()).done;){var r=e.value;r.children.display.fillColor=y.colors.pieces[r.data.id],r.children.insetBorder.strokeColor=y.colors.pieces[r.data.id]}var n=Object.values(y.colors.pieces);if(C)for(var a,o=fn(G.current);!(a=o()).done;){a.value.fillColor=n[Math.floor(Math.random()*n.length)]}}),[y.colors,$,C]),(0,a.useEffect)((function(){o()}),[]),a.createElement(l,{css:{flex:"1",position:"relative",color:"dialogText",animation:f.FADE_TRANSITION_DURATION+"ms fadeIn ease"}},$&&!1===x&&a.createElement(l,{css:{zIndex:-1,position:"absolute",top:3,right:3,cursor:"pointer"}},a.createElement(re,{tangram:$,selected:!0,hideBadge:!0})),a.createElement(l,{as:"canvas",ref:V,css:{minHeight:"auto",flex:1}}),$&&U&&a.createElement(dn,{tangram:$,onStop:function(){F(!1),M(null),r()},onNext:D<I.length-1?function(){F(!1),P(D+1),r()}:void 0,onApprove:b&&b.isAdmin&&!$.approved?Z:void 0,onStarToggle:b&&$.approved?function(){return j($)}:void 0}))},gn=function(){var e=s(),t=(0,a.useContext)(S),r=(0,a.useState)(!1),n=r[0],o=r[1],i=(0,a.useState)(!1),c=i[0],u=i[1],m=(0,a.useState)(!1),p=m[0],g=m[1],v=(0,a.useState)(!1),h=v[0],b=v[1],y=(0,a.useContext)(j).initialized,E=(0,a.useContext)(L),w=E.playlist,x=E.initialized,C=(0,a.useContext)(O),k=C.currentUser,A=C.initialized&&y&&x&&w;if((0,a.useEffect)((function(){setTimeout((function(){return o(!0)}),2*f.FADE_TRANSITION_DURATION),g(setTimeout((function(){return u(!0)}),2*f.FADE_TRANSITION_DURATION))}),[]),(0,a.useEffect)((function(){A&&(clearTimeout(p),u(!1))}),[A]),h)return a.createElement(a.Fragment,null,a.createElement(pn,null),a.createElement(Gr,null));return a.createElement(l,{css:{flex:"1",alignItems:"center",justifyContent:"center",gap:3,animation:A&&n?f.FADE_TRANSITION_DURATION+"ms fadeIn ease "+f.FADE_STAGGER_DURATION+"ms reverse":void 0},deps:[A,n],onAnimationEnd:function(r){r.currentTarget===r.target&&(b(!0),k&&t(e.formatMessage({id:"Logged in as {username}"},{username:k.username})))}},a.createElement(l,{css:{animation:f.FADE_TRANSITION_DURATION+"ms fadeIn ease "+f.FADE_STAGGER_DURATION+"ms both"}},a.createElement(d,{css:{size:"logo",overflow:"visible","& > g":{transition:"all "+f.FADE_TRANSITION_DURATION+"ms ease",transform:A&&n?"translate(30px, -30px)":"translate(0, 0)"}},deps:[A,n]})),a.createElement(ce,{css:{transition:"opacity "+f.FADE_TRANSITION_DURATION+"ms ease",opacity:c?1:0},deps:[c]},e.formatMessage({id:"Loading..."})))},vn=function(){return(0,a.useEffect)((function(){window.oncontextmenu=function(){return!1}}),[]),(0,n.useGlobalCss)({body:{m:0,bg:"background",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", "Roboto",\n        "Oxygen", "Ubuntu", "Cantarell", "Fira Sans", "Droid Sans",\n        "Helvetica Neue", sans-serif',"-webkit-font-smoothing":"antialiased","-moz-osx-font-smoothing":"grayscale",transition:"background-color "+f.COLOR_TRANSITION_DURATION+"ms"},"body, html, #___gatsby, #gatsby-focus-wrapper":{height:"100%"},"#gatsby-focus-wrapper":{display:"flex",flexDirection:"column",padding:"\n        env(safe-area-inset-top, 0)\n        env(safe-area-inset-right, 0)\n        env(safe-area-inset-bottom, 0)\n        env(safe-area-inset-left, 0)\n      "},"*":{boxSizing:"border-box",userSelect:"none","-moz-user-select":"none","-khtml-user-select":"none","-webkit-user-select":"none","-webkit-tap-highlight-color":"rgba(0,0,0,0)"},"input, textarea":{"-webkit-user-select":"initial","-moz-user-select":"initial","-ms-user-select":"initial",userSelect:"initial"}}),a.createElement(Y,null,a.createElement(ur.LanguageProvider,null,a.createElement(C,null,a.createElement(I,null,a.createElement(_,null,a.createElement(Or,null,a.createElement(Ur,null,a.createElement(P,null,a.createElement(Dr,null,a.createElement(zr,null,a.createElement(l,{css:{flex:"1",color:"dialogText",fontSize:3}},a.createElement(gn,null))))))))))))}},5666:function(e){var t=function(e){"use strict";var t,r=Object.prototype,n=r.hasOwnProperty,a="function"==typeof Symbol?Symbol:{},o=a.iterator||"@@iterator",i=a.asyncIterator||"@@asyncIterator",s=a.toStringTag||"@@toStringTag";function c(e,t,r,n){var a=t&&t.prototype instanceof g?t:g,o=Object.create(a.prototype),i=new O(n||[]);return o._invoke=function(e,t,r){var n=l;return function(a,o){if(n===f)throw new Error("Generator is already running");if(n===m){if("throw"===a)throw o;return M()}for(r.method=a,r.arg=o;;){var i=r.delegate;if(i){var s=C(i,r);if(s){if(s===p)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(n===l)throw n=m,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n=f;var c=u(e,t,r);if("normal"===c.type){if(n=r.done?m:d,c.arg===p)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(n=m,r.method="throw",r.arg=c.arg)}}}(e,r,i),o}function u(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(n){return{type:"throw",arg:n}}}e.wrap=c;var l="suspendedStart",d="suspendedYield",f="executing",m="completed",p={};function g(){}function v(){}function h(){}var b={};b[o]=function(){return this};var y=Object.getPrototypeOf,E=y&&y(y(I([])));E&&E!==r&&n.call(E,o)&&(b=E);var w=h.prototype=g.prototype=Object.create(b);function x(e){["next","throw","return"].forEach((function(t){e[t]=function(e){return this._invoke(t,e)}}))}function S(e,t){function r(a,o,i,s){var c=u(e[a],e,o);if("throw"!==c.type){var l=c.arg,d=l.value;return d&&"object"==typeof d&&n.call(d,"__await")?t.resolve(d.__await).then((function(e){r("next",e,i,s)}),(function(e){r("throw",e,i,s)})):t.resolve(d).then((function(e){l.value=e,i(l)}),(function(e){return r("throw",e,i,s)}))}s(c.arg)}var a;this._invoke=function(e,n){function o(){return new t((function(t,a){r(e,n,t,a)}))}return a=a?a.then(o,o):o()}}function C(e,r){var n=e.iterator[r.method];if(n===t){if(r.delegate=null,"throw"===r.method){if(e.iterator.return&&(r.method="return",r.arg=t,C(e,r),"throw"===r.method))return p;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var a=u(n,e.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,p;var o=a.arg;return o?o.done?(r[e.resultName]=o.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,p):o:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,p)}function k(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function A(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function O(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(k,this),this.reset(!0)}function I(e){if(e){var r=e[o];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var a=-1,i=function r(){for(;++a<e.length;)if(n.call(e,a))return r.value=e[a],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}return{next:M}}function M(){return{value:t,done:!0}}return v.prototype=w.constructor=h,h.constructor=v,h[s]=v.displayName="GeneratorFunction",e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===v||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,h):(e.__proto__=h,s in e||(e[s]="GeneratorFunction")),e.prototype=Object.create(w),e},e.awrap=function(e){return{__await:e}},x(S.prototype),S.prototype[i]=function(){return this},e.AsyncIterator=S,e.async=function(t,r,n,a,o){void 0===o&&(o=Promise);var i=new S(c(t,r,n,a),o);return e.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},x(w),w[s]="Generator",w[o]=function(){return this},w.toString=function(){return"[object Generator]"},e.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function r(){for(;t.length;){var n=t.pop();if(n in e)return r.value=n,r.done=!1,r}return r.done=!0,r}},e.values=I,O.prototype={constructor:O,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(A),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function a(n,a){return s.type="throw",s.arg=e,r.next=n,a&&(r.method="next",r.arg=t),!!a}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],s=i.completion;if("root"===i.tryLoc)return a("end");if(i.tryLoc<=this.prev){var c=n.call(i,"catchLoc"),u=n.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return a(i.catchLoc,!0);if(this.prev<i.finallyLoc)return a(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return a(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return a(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.tryLoc<=this.prev&&n.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var o=a;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var i=o?o.completion:{};return i.type=e,i.arg=t,o?(this.method="next",this.next=o.finallyLoc,p):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),p},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),A(r),p}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var a=n.arg;A(r)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:I(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),p}},e}(e.exports);try{regeneratorRuntime=t}catch(r){Function("r","regeneratorRuntime = r")(t)}},858:function(){},4158:function(){}}]);
//# sourceMappingURL=component---src-pages-index-js-96c482de09937244a3be.js.map